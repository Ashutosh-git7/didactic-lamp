<!DOCTYPE html>
<html>
<head>
  <title>Ashirwad 2X App</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    h2, h3 {
      margin-top: 0;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
    }
    .hidden { display: none; }
    .success { color: green; }
    .error { color: red; }
    .admin-card {
      background: #e9f7ef;
      border: 1px solid #b2dfdb;
    }
    .admin-buttons button {
      margin-top: 5px;
      background: #28a745;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="authCard" class="card">
      <h2>Login / Register</h2>
      <input type="text" id="loginId" placeholder="User ID or New ID" />
      <input type="password" id="loginPass" placeholder="Password or New Password" />
      <input type="text" id="wallet" placeholder="Your BEP20 USDT Wallet (new users only)" />
      <button onclick="login()">Login / Register</button>
      <p id="authMsg"></p>
    </div>

    <div id="dashboardCard" class="card hidden">
      <h2>Welcome, <span id="uid"></span></h2>
      <p><strong>Wallet:</strong> <span id="userWallet"></span></p>
      <p><strong>Referral Link:</strong><br><span id="refLink"></span></p>
      <p><strong>Deposit Address:</strong><br><code>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</code></p>

      <h3>Deposit</h3>
      <input type="number" id="depositAmt" placeholder="Amount (50 - 500 USDT)" />
      <button onclick="requestDeposit()">Request Deposit</button>
      <p id="depositStatus"></p>

      <h3>Withdraw</h3>
      <input type="number" id="withdrawAmt" placeholder="Minimum 1 USDT" />
      <button onclick="requestWithdraw()">Request Withdrawal</button>
      <p id="withdrawStatus"></p>

      <h3>Summary</h3>
      <p>Deposit: <span id="sumDeposit">0</span> USDT</p>
      <p>Income: <span id="sumIncome">0</span> USDT</p>
      <p>Referral Income: <span id="refIncome">0</span> USDT</p>
      <p>Withdrawn: <span id="sumWithdraw">0</span> USDT</p>

      <button onclick="logout()">Logout</button>
    </div>

    <div id="adminLoginCard" class="card">
      <h2>Admin Login</h2>
      <input type="text" id="adminId" placeholder="Admin ID" />
      <input type="password" id="adminPass" placeholder="Password" />
      <button onclick="adminLogin()">Login as Admin</button>
      <p id="adminLoginMsg"></p>
    </div>

    <div id="adminPanel" class="card hidden">
      <h2>Admin Panel</h2>
      <div id="userList"></div>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem("users") || "{}");
    let current = null;

    function saveUsers() {
      localStorage.setItem("users", JSON.stringify(users));
    }

    function login() {
      const id = loginId.value.trim();
      const pass = loginPass.value.trim();
      const walletVal = wallet.value.trim();
      if (!id || !pass) return showMsg('authMsg', 'Please enter ID and password', 'error');

      if (!users[id]) {
        if (!walletVal) return showMsg('authMsg', 'Wallet required for new users', 'error');
        users[id] = {
          pass,
          wallet: walletVal,
          deposit: 0,
          approved: false,
          income: 0,
          withdraw: 0,
          refIncome: 0,
          refBy: getRef(),
          closed: false
        };
      } else if (users[id].pass !== pass) {
        return showMsg('authMsg', 'Incorrect password', 'error');
      }

      current = id;
      saveUsers();
      showDashboard();
    }

    function getRef() {
      const params = new URLSearchParams(location.search);
      return params.get("r") || "";
    }

    function showDashboard() {
      document.getElementById("authCard").classList.add("hidden");
      document.getElementById("dashboardCard").classList.remove("hidden");
      document.getElementById("adminLoginCard").classList.add("hidden");
      const u = users[current];
      uid.innerText = current;
      userWallet.innerText = u.wallet;
      refLink.innerText = location.href.split("?")[0] + "?r=" + current;
      sumDeposit.innerText = u.deposit;
      sumIncome.innerText = u.income.toFixed(2);
      refIncome.innerText = u.refIncome.toFixed(2);
      sumWithdraw.innerText = u.withdraw.toFixed(2);
    }

    function requestDeposit() {
      const amt = parseFloat(depositAmt.value);
      if (amt < 50 || amt > 500) return showMsg("depositStatus", "Deposit must be 50-500", "error");
      const u = users[current];
      if (u.approved) return showMsg("depositStatus", "Deposit already active", "error");
      u.deposit = amt;
      u.approved = false;
      u.income = 0;
      u.closed = false;
      if (u.refBy && users[u.refBy]) {
        users[u.refBy].refIncome += amt * 0.05;
      }
      saveUsers();
      showMsg("depositStatus", "Deposit requested. Wait for admin approval.", "success");
    }

    function requestWithdraw() {
      const amt = parseFloat(withdrawAmt.value);
      const u = users[current];
      const total = u.income + u.refIncome;
      if (amt < 1) return showMsg("withdrawStatus", "Minimum 1 USDT", "error");
      if (amt > total) return showMsg("withdrawStatus", "Not enough balance", "error");

      if (amt <= u.income) {
        u.income -= amt;
      } else {
        const diff = amt - u.income;
        u.income = 0;
        u.refIncome -= diff;
      }
      u.withdraw += amt;
      saveUsers();
      showMsg("withdrawStatus", "Withdraw successful", "success");
      showDashboard();
    }

    function logout() {
      current = null;
      document.getElementById("dashboardCard").classList.add("hidden");
      document.getElementById("adminPanel").classList.add("hidden");
      document.getElementById("authCard").classList.remove("hidden");
      document.getElementById("adminLoginCard").classList.remove("hidden");
    }

    function showMsg(id, text, type) {
      const el = document.getElementById(id);
      el.innerText = text;
      el.className = type;
      setTimeout(() => el.innerText = "", 4000);
    }

    function adminLogin() {
      const id = adminId.value.trim();
      const pass = adminPass.value.trim();
      if (id === "Admin" && pass === "Jaihanuman@7") {
        showAdminPanel();
      } else {
        showMsg("adminLoginMsg", "Wrong admin credentials", "error");
      }
    }

    function showAdminPanel() {
      document.getElementById("adminLoginCard").classList.add("hidden");
      document.getElementById("authCard").classList.add("hidden");
      document.getElementById("dashboardCard").classList.add("hidden");
      document.getElementById("adminPanel").classList.remove("hidden");
      const list = document.getElementById("userList");
      list.innerHTML = "";

      Object.keys(users).forEach(id => {
        const u = users[id];
        const div = document.createElement("div");
        div.className = "card admin-card";
        div.innerHTML = `
          <strong>ID:</strong> ${id}<br>
          <strong>Wallet:</strong> ${u.wallet}<br>
          <strong>Deposit:</strong> ${u.deposit} | Approved: ${u.approved}<br>
          <strong>Income:</strong> ${u.income.toFixed(2)} | Referral: ${u.refIncome.toFixed(2)}<br>
          <strong>Withdrawn:</strong> ${u.withdraw.toFixed(2)} | Closed: ${u.closed}<br>
          <div class="admin-buttons">
            <button onclick="approve('${id}')">Approve Deposit</button>
            <button onclick="addIncome('${id}')">Add Weekly Income</button>
            <button onclick="closeAgreement('${id}')">Close Agreement</button>
          </div>
        `;
        list.appendChild(div);
      });
    }

    function approve(id) {
      if (users[id]) {
        users[id].approved = true;
        saveUsers();
        showAdminPanel();
      }
    }

    function addIncome(id) {
      const u = users[id];
      if (!u.approved || u.closed) return;
      const income = u.deposit * 0.1;
      u.income += income;
      if (u.income >= u.deposit * 2) {
        u.closed = true;
      }
      saveUsers();
      showAdminPanel();
    }

    function closeAgreement(id) {
      users[id].closed = true;
      saveUsers();
      showAdminPanel();
    }
  </script>
</body>
</html>
