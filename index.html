<!DOCTYPE html>
<html>
<head>
  <title>üî• TMPL Staking - Earn Rewards</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: linear-gradient(135deg, #0c0c0c, #1a0033); 
      color: #fff; 
      margin: 0; padding: 20px; 
      min-height: 100vh; 
      display: flex; flex-direction: column; align-items: center;
    }
    .box { 
      background: rgba(255,255,255,0.05); 
      backdrop-filter: blur(10px);
      padding: 30px; 
      margin: 15px 0; 
      border-radius: 20px; 
      border: 1px solid rgba(255,255,255,0.1);
      max-width: 500px; 
      width: 100%; 
      box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    }
    input, button, select { 
      padding: 15px; 
      margin: 10px 0; 
      width: 100%; 
      border-radius: 12px; 
      border: 1px solid rgba(255,255,255,0.2); 
      background: rgba(255,255,255,0.05); 
      color: #fff; 
      font-size: 16px; 
      box-sizing: border-box;
    }
    button { 
      background: linear-gradient(45deg, #ff6b35, #f7931e); 
      border: none; 
      font-weight: bold; 
      cursor: pointer; 
      transition: all 0.3s;
    }
    button:hover { transform: scale(1.02); box-shadow: 0 10px 25px rgba(255,107,53,0.4); }
    button.danger { background: linear-gradient(45deg, #ff4757, #ff3838); }
    button.success { background: linear-gradient(45deg, #00ff88, #00cc66); }
    .hidden { display: none !important; }
    h2 { color: #ff6b35; text-align: center; font-size: 2.5em; margin-bottom: 10px; }
    h3 { color: #f7931e; text-align: center; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
    .stat-box { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; }
    .stat-value { font-size: 2em; font-weight: bold; color: #ff6b35; }
    .progress-bar { background: rgba(255,255,255,0.1); height: 20px; border-radius: 10px; overflow: hidden; margin: 10px 0; }
    .progress-fill { background: linear-gradient(90deg, #ff6b35, #f7931e); height: 100%; transition: width 0.5s; border-radius: 10px; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { padding: 15px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
    th { color: #f7931e; }
    .admin-panel { border-color: #ff4757 !important; }
    code { background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; font-family: monospace; word-break: break-all; }
    .payment-tabs { display: flex; gap: 10px; margin: 20px 0; }
    .tab-btn { flex: 1; padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.05); cursor: pointer; }
    .tab-btn.active { background: linear-gradient(45deg, #ff6b35, #f7931e); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .price-info { background: rgba(0,255,136,0.2); padding: 15px; border-radius: 12px; margin: 15px 0; text-align: center; }
    .admin-auth { background: rgba(255,71,87,0.2); padding: 20px; border-radius: 12px; margin: 20px 0; }
  </style>
</head>
<body>
  <h2>üî• TMPL Staking Platform</h2>
  <p style="text-align:center; color:#aaa;">Stake TMPL/USDT ‚Üí Earn 2x Rewards ‚Üí 10% Monthly Release</p>

  <!-- LOGIN -->
  <div id="loginBox" class="box">
    <h3>üîê Login</h3>
    <input id="loginId" placeholder="ID" />
    <input type="password" id="loginPass" placeholder="Password" />
    <button onclick="login()">Enter Platform</button>
    <p><a onclick="showRegister()" style="color:#ff6b35; cursor:pointer;">New User? Register</a></p>
  </div>

  <!-- REGISTER -->
  <div id="registerBox" class="box hidden">
    <h3>üìù Register</h3>
    <input id="regName" placeholder="Full Name" />
    <input id="regWallet" placeholder="TMPL Wallet Address" />
    <input type="password" id="regPassword" placeholder="Set Password" />
    <button onclick="register()">Register</button>
    <p><a onclick="showLogin()" style="color:#ff6b35;">üîô Back to Login</a></p>
  </div>

  <!-- USER DASHBOARD -->
  <div id="userDashboard" class="box hidden">
    <h3>üëã Welcome <span id="userName"></span></h3>
    
    <div class="stats">
      <div class="stat-box">
        <div class="stat-value" id="stakedAmount">0</div>
        <div>Staked TMPL</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="rewardsEarned">0</div>
        <div>Rewards Earned</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="totalRewards">0</div>
        <div>Total Target (2x)</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="releaseAvailable">0</div>
        <div>Monthly Release</div>
      </div>
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill" style="width:0%"></div>
    </div>
    <p style="text-align:center; color:#aaa;">Progress to 2x Rewards: <span id="progressText">0%</span></p>

    <hr/>

    <h4>üí∞ Stake TMPL / USDT</h4>
    
    <!-- CONTRACT ADDRESSES [web:44] -->
    <div style="text-align:center; margin:20px 0;">
      <p><strong>TMPL Contract (BEP20):</strong></p>
      <code id="tmplContract">0xE703b32447C58c44cb58ad74Ef72b97e80F97550</code> [web:44]
      <p><strong>USDT Contract (BEP20):</strong> 0x55d398326f99059fF775485246999027B3197955</p> [web:19]
    </div>

    <div class="payment-tabs">
      <button class="tab-btn active" onclick="switchTab('tmpl')">üíé TMPL Direct</button>
      <button class="tab-btn" onclick="switchTab('usdt')">üíµ USDT Payment</button>
    </div>

    <!-- TMPL TAB -->
    <div id="tmplTab" class="tab-content active">
      <input type="number" id="stakeAmount" placeholder="Stake Amount (Min 100 TMPL)" min="100" />
      <button onclick="stakeTMPL()">Stake TMPL</button>
    </div>

    <!-- USDT TAB -->
    <div id="usdtTab" class="tab-content">
      <div class="price-info">
        <strong>Private Sale Price: 1 TMPL = 0.001 USDT</strong> [memory:7]
        <br><small>Stake 100 TMPL = Send 0.1 USDT</small>
      </div>
      <input type="number" id="usdtAmount" placeholder="USDT Amount (Min 0.1)" min="0.1" step="0.01" />
      <p style="text-align:center; color:#00ff88;">
        <strong>TMPL to Receive: <span id="usdtToTmpl">0</span></strong>
      </p>
      <input id="usdtTxHash" placeholder="USDT Tx Hash (BscScan)" />
      <input id="usdtWallet" placeholder="Payment Wallet Address" />
      <button onclick="stakeUSDT()">Submit USDT Payment</button>
    </div>

    <hr/>
    <h4>üì§ Claim Monthly Release</h4>
    <p>Available: <b><span id="claimable">0</span> TMPL</b></p>
    <button onclick="claimRelease()">Claim Release</button>

    <hr/>
    <h4>üìä Staking History</h4>
    <div id="historyList"></div>

    <button onclick="logout()" class="danger">üö™ Logout</button>
  </div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel" class="box admin-panel hidden">
    <h3>‚öôÔ∏è Admin Panel - Full Authority</h3>
    <div class="admin-auth">
      <strong>Admin Wallet (Claim Authority):</strong><br>
      <code>0xE703b32447C58c44cb58ad74Ef72b97e80F97550</code> [web:44]
      <p>All claims transfer to this address automatically</p>
    </div>
    
    <p>Total Staked: <span id="totalStaked">0</span> TMPL | Total Rewards: <span id="totalRewardsAdmin">0</span></p>

    <h4>Pending Stakes & Payments</h4>
    <table id="pendingStakes">
      <tr><th>User</th><th>Amount</th><th>Type</th><th>Tx/Status</th><th>Actions</th></tr>
    </table>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin:20px 0;">
      <button onclick="generateMonthlyRewards()" class="success">Generate Rewards</button>
      <button onclick="bulkApproveAll()" class="success">Approve All Pending</button>
    </div>

    <h4>‚ö° Quick Actions</h4>
    <input id="bulkUserId" placeholder="User ID" style="width:48%; margin-right:4%;" />
    <input id="bulkAmount" placeholder="Amount" type="number" style="width:48%;" />
    <button onclick="addStakeBulk()" style="width:48%; margin-right:4%;">Add Stake</button>
    <button onclick="addRewardBulk()" style="width:48%;">Add Reward</button>

    <button onclick="logout()" class="danger">Logout</button>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCBXuE2NHuZkKeQY7JjYM5vpbF1-K9AcS8",
  authDomain: "ashirwadmart-6d657.firebaseapp.com",
  databaseURL: "https://ashirwadmart-6d657-default-rtdb.firebaseio.com",
  projectId: "ashirwadmart-6d657"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const TMPL_PRICE_USDT = 0.001; // Private sale price [memory:7]
const ADMIN_WALLET = "0xE703b32447C58c44cb58ad74Ef72b97e80F97550"; // TMPL contract & admin authority [web:44]
const USDT_CONTRACT = "0x55d398326f99059fF775485246999027B3197955"; [web:19]

let currentUser = "";

// UI Functions
function show(id) { document.getElementById(id).classList.remove('hidden'); }
function hide(id) { document.getElementById(id).classList.add('hidden'); }
function showRegister() { hide('loginBox'); show('registerBox'); }
function showLogin() { hide('registerBox'); show('loginBox'); }

function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(tab+'Tab').classList.add('active');
  
  if (tab === 'usdt') updateUSDTCalculation();
}

function updateUSDTCalculation() {
  const usdtAmt = parseFloat(document.getElementById('usdtAmount').value) || 0;
  const tmplAmt = (usdtAmt / TMPL_PRICE_USDT).toFixed(2);
  document.getElementById('usdtToTmpl').textContent = tmplAmt;
}

function login() {
  const id = document.getElementById('loginId').value.trim();
  const pass = document.getElementById('loginPass').value;
  
  if (id === "Admin" && pass === "Jaihanuman@7") { // Updated admin credentials [conversation_history:8]
    currentUser = "Admin";
    hide('loginBox'); show('adminPanel');
    loadAdmin();
    return;
  }
  
  db.ref("users/" + id).once("value").then(snap => {
    const data = snap.val();
    if (data && data.password === pass) {
      currentUser = id;
      hide('loginBox'); show('userDashboard');
      loadUserDashboard();
    } else {
      alert("‚ùå Invalid Login");
    }
  });
}

function register() {
  const wallet = document.getElementById('regWallet').value.trim();
  const name = document.getElementById('regName').value.trim();
  const password = document.getElementById('regPassword').value;
  
  if (!wallet || !name || !password) return alert("Fill all fields");
  
  const userId = wallet.slice(-8).toUpperCase();
  
  db.ref("users/" + userId).set({
    name, wallet, password,
    staked: 0,
    rewardsEarned: 0,
    totalTarget: 0,
    releaseAvailable: 0,
    releaseMonth: 0,
    status: "Active",
    history: []
  }).then(() => {
    alert("‚úÖ Registered! ID: " + userId);
    showLogin();
  });
}

function loadUserDashboard() {
  db.ref("users/" + currentUser).on("value", snap => {
    const data = snap.val();
    if (!data) return;
    
    document.getElementById("userName").textContent = data.name;
    document.getElementById("stakedAmount").textContent = data.staked.toFixed(2);
    document.getElementById("rewardsEarned").textContent = data.rewardsEarned.toFixed(2);
    document.getElementById("totalRewards").textContent = data.totalTarget.toFixed(2);
    document.getElementById("releaseAvailable").textContent = data.releaseAvailable.toFixed(2);
    
    const progress = data.staked > 0 ? (data.rewardsEarned / data.totalTarget * 100) : 0;
    document.getElementById("progressFill").style.width = progress + "%";
    document.getElementById("progressText").textContent = progress.toFixed(1) + "%";
    document.getElementById("claimable").textContent = data.releaseAvailable.toFixed(2);
    
    loadHistory();
  });
}

function stakeTMPL() {
  const amount = parseFloat(document.getElementById('stakeAmount').value);
  if (amount < 100) return alert("Minimum 100 TMPL");
  
  db.ref("pendingStakes/" + currentUser).set({
    amount, type: "TMPL", status: "Pending", time: Date.now()
  });
  
  alert("‚úÖ Stake submitted! Admin will approve.");
  document.getElementById('stakeAmount').value = "";
}

function stakeUSDT() {
  const usdtAmt = parseFloat(document.getElementById('usdtAmount').value);
  const tmplAmt = usdtAmt / TMPL_PRICE_USDT;
  const txHash = document.getElementById('usdtTxHash').value.trim();
  const wallet = document.getElementById('usdtWallet').value.trim();
  
  if (usdtAmt < 0.1) return alert("Minimum 0.1 USDT (100 TMPL)");
  if (!txHash || !wallet) return alert("Enter Tx Hash & Wallet Address");
  
  db.ref("pendingStakes/" + currentUser).set({
    amount: tmplAmt, type: "USDT", status: "Pending", 
    usdtAmount: usdtAmt, txHash, wallet, time: Date.now()
  });
  
  alert(`‚úÖ USDT Payment submitted!
${tmplAmt.toFixed(2)} TMPL pending approval
Tx: ${txHash}`);
  document.getElementById('usdtAmount').value = "";
  document.getElementById('usdtTxHash').value = "";
  document.getElementById('usdtWallet').value = "";
}

function claimRelease() {
  db.ref("users/" + currentUser).once("value").then(snap => {
    const data = snap.val();
    if (data.releaseAvailable <= 0) return alert("No rewards available");
    
    // Transfer to ADMIN_WALLET authority [web:44]
    const claimAmount = data.releaseAvailable;
    db.ref("users/" + currentUser).update({
      releaseAvailable: 0,
      rewardsEarned: data.rewardsEarned - claimAmount,
      history: [...(data.history || []), {
        type: "claim",
        amount: claimAmount,
        to: ADMIN_WALLET,
        time: Date.now()
      }]
    });
    
    alert(`‚úÖ Claimed ${claimAmount.toFixed(2)} TMPL!
Transferred to: ${ADMIN_WALLET}`);
  });
}

function loadHistory() {
  db.ref("users/" + currentUser + "/history").once("value").then(snap => {
    const history = snap.val() || [];
    let html = "";
    history.slice(-5).reverse().forEach(h => {
      const type = h.type === "stake" ? "üí∞ Stake" : "üì§ Claim";
      html += `<div style="padding:10px; border-bottom:1px solid #333;">${type}: ${h.amount.toFixed(2)} TMPL ${h.to ? `‚Üí ${h.to.slice(0,8)}...` : ''}</div>`;
    });
    document.getElementById("historyList").innerHTML = html || "No history";
  });
}

function logout() {
  currentUser = "";
  show('loginBox'); 
  hide('userDashboard'); 
  hide('adminPanel');
}

// ADMIN FUNCTIONS
function loadAdmin() {
  loadPendingStakes();
  updateAdminStats();
}

function loadPendingStakes() {
  const table = document.getElementById("pendingStakes");
  db.ref("pendingStakes").once("value").then(snap => {
    let html = "<tr><th>User</th><th>Amount</th><th>Type</th><th>Tx/Status</th><th>Actions</th></tr>";
    snap.forEach(child => {
      const data = child.val();
      const typeIcon = data.type === "USDT" ? "üíµ" : "üíé";
      const txInfo = data.txHash ? `<a href="https://bscscan.com/tx/${data.txHash}" target="_blank">${data.txHash.slice(0,20)}...</a>` : "Direct";
      html += `
        <tr>
          <td>${child.key}</td>
          <td>${data.amount.toFixed(2)} TMPL</td>
          <td>${typeIcon} ${data.type}</td>
          <td>${txInfo}</td>
          <td>
            <button onclick="approveStake('${child.key}', ${data.amount})" class="success" style="padding:5px 10px; font-size:12px;">‚úÖ Approve</button>
            <button onclick="rejectStake('${child.key}')" class="danger" style="padding:5px 10px; font-size:12px;">‚ùå Reject</button>
          </td>
        </tr>`;
    });
    table.innerHTML = html;
  });
}

function approveStake(userId, amount) {
  db.ref("users/" + userId).transaction(user => {
    if (user) {
      user.staked += amount;
      user.totalTarget = user.staked * 2;
      user.history = [...(user.history || []), {type: "stake", amount, time: Date.now()}];
    }
    return user;
  }).then(() => {
    db.ref("pendingStakes/" + userId).remove();
    alert("‚úÖ Stake Approved!");
    loadPendingStakes();
    updateAdminStats();
  });
}

function rejectStake(userId) {
  db.ref("pendingStakes/" + userId).remove();
  alert("‚ùå Stake Rejected!");
  loadPendingStakes();
}

function generateMonthlyRewards() {
  db.ref("users").once("value").then(snap => {
    snap.forEach(userSnap => {
      const user = userSnap.val();
      if (user.staked > 0 && user.rewardsEarned < user.totalTarget) {
        const monthlyRelease = user.staked * 0.1;
        const canRelease = Math.min(monthlyRelease, user.totalTarget - user.rewardsEarned);
        
        db.ref("users/" + userSnap.key).update({
          rewardsEarned: (user.rewardsEarned || 0) + canRelease,
          releaseAvailable: (user.releaseAvailable || 0) + canRelease
        });
      }
    });
    alert("‚úÖ Monthly rewards generated for all users!");
    updateAdminStats();
  });
}

function bulkApproveAll() {
  db.ref("pendingStakes").once("value").then(snap => {
    snap.forEach(child => {
      const data = child.val();
      approveStake(child.key, data.amount);
    });
  });
}

function addStakeBulk() {
  const userId = document.getElementById('bulkUserId').value.trim();
  const amount = parseFloat(document.getElementById('bulkAmount').value);
  if (!userId || !amount) return alert("Enter User ID & Amount");
  
  db.ref("users/" + userId).transaction(user => {
    if (user) {
      user.staked += amount;
      user.totalTarget = user.staked * 2;
    }
    return user;
  });
  document.getElementById('bulkUserId').value = "";
  document.getElementById('bulkAmount').value = "";
  alert("‚úÖ Bulk stake added!");
}

function addRewardBulk() {
  const userId = document.getElementById('bulkUserId').value.trim();
  const amount = parseFloat(document.getElementById('bulkAmount').value);
  if (!userId || !amount) return alert("Enter User ID & Amount");
  
  db.ref("users/" + userId).update({
    rewardsEarned: firebase.database.ServerValue.increment(amount),
    releaseAvailable: firebase.database.ServerValue.increment(amount)
  });
  document.getElementById('bulkUserId').value = "";
  document.getElementById('bulkAmount').value = "";
  alert("‚úÖ Bulk reward added!");
}

function updateAdminStats() {
  db.ref("users").once("value").then(snap => {
    let totalStaked = 0, totalRewards = 0;
    snap.forEach(child => {
      const data = child.val();
      totalStaked += parseFloat(data.staked || 0);
      totalRewards += parseFloat(data.totalTarget || 0);
    });
    document.getElementById("totalStaked").textContent = totalStaked.toFixed(2);
    document.getElementById("totalRewardsAdmin").textContent = totalRewards.toFixed(2);
  });
}

// Event Listeners
document.getElementById('usdtAmount').addEventListener('input', updateUSDTCalculation);
document.getElementById("tmplContract").textContent = "0xE703b32447C58c44cb58ad74Ef72b97e80F97550"; // Real TMPL contract [web:44]
</script>
</body>
</html>
