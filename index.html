<!DOCTYPE html>
<html>
<head>
  <title>USDT 2X Plan App</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f0f2f5; }
    .container { max-width: 400px; margin: auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 0 10px #ccc; margin-top: 30px; }
    input, button, select { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { background-color: #4CAF50; color: white; font-weight: bold; }
    .admin-table { width: 100%; font-size: 12px; overflow-x: scroll; }
    .admin-table th, .admin-table td { padding: 5px; border: 1px solid #ccc; }
    .hidden { display: none; }
    .referral { font-size: 12px; margin-top: 10px; word-break: break-word; }
    .btn-small { font-size: 12px; padding: 5px; }
  </style>
</head>
<body>

<div class="container" id="authSection">
  <h2>Login / Register</h2>
  <input type="text" id="userId" placeholder="Your ID (leave blank to register)" />
  <input type="text" id="refCode" placeholder="Referral Code (optional)" />
  <input type="text" id="wallet" placeholder="Your BEP20 Wallet (for registration)" />
  <input type="password" id="password" placeholder="Password" />
  <button onclick="login()">Login / Register</button>
</div>

<div class="container hidden" id="userSection">
  <h2>Welcome, <span id="loggedUser"></span></h2>
  <p>Your Wallet: <span id="userWallet"></span></p>
  <p>Referral Link: <span class="referral" id="refLink"></span></p>
  <h3>Deposit (50–500 USDT)</h3>
  <p>Send USDT to: <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
  <input type="number" id="depositAmount" placeholder="Enter Deposit Amount" />
  <button onclick="makeDeposit()">Submit Deposit</button>
  <h3>Withdraw</h3>
  <input type="number" id="withdrawAmount" placeholder="Amount ≥ 1 USDT" />
  <button onclick="requestWithdraw()">Request Withdraw</button>
  <h3>Your Summary</h3>
  <p>Deposit: <span id="userDeposit">0</span></p>
  <p>Received: <span id="userReceived">0</span></p>
  <p>Referral Bonus: <span id="userReferral">0</span></p>
  <p>Withdrawn: <span id="userWithdraw">0</span></p>
  <button onclick="logout()">Logout</button>
</div>

<div class="container hidden" id="adminSection">
  <h2>Admin Panel</h2>
  <div id="adminData"></div>
  <button onclick="logout()">Logout</button>
</div>

<script>
  let users = JSON.parse(localStorage.getItem("users") || "{}");
  let currentUser = null;

  function generateId() {
    return 'u' + Math.random().toString(36).substring(2, 6);
  }

  function login() {
    let id = document.getElementById("userId").value.trim();
    let ref = document.getElementById("refCode").value.trim().toLowerCase();
    let wallet = document.getElementById("wallet").value.trim();
    let pass = document.getElementById("password").value;

    if (id.toLowerCase() === "admin" && pass === "Jaihanuman@7") {
      currentUser = "admin";
      document.getElementById("authSection").classList.add("hidden");
      document.getElementById("adminSection").classList.remove("hidden");
      renderAdmin();
      return;
    }

    if (!id) {
      id = generateId();
      users[id] = { wallet, pass, deposit: 0, received: 0, referral: 0, withdraw: 0, refby: ref, active: false };
    }

    if (!users[id]) {
      alert("User not found. Please register.");
      return;
    }

    if (users[id].pass !== pass) {
      alert("Wrong password");
      return;
    }

    currentUser = id;
    localStorage.setItem("users", JSON.stringify(users));
    showUserDashboard();
  }

  function logout() {
    currentUser = null;
    document.getElementById("authSection").classList.remove("hidden");
    document.getElementById("userSection").classList.add("hidden");
    document.getElementById("adminSection").classList.add("hidden");
  }

  function showUserDashboard() {
    document.getElementById("authSection").classList.add("hidden");
    document.getElementById("userSection").classList.remove("hidden");
    document.getElementById("loggedUser").innerText = currentUser;
    document.getElementById("userWallet").innerText = users[currentUser].wallet;
    document.getElementById("refLink").innerText = `${location.href.split("?")[0]}?r=${currentUser}`;
    document.getElementById("userDeposit").innerText = users[currentUser].deposit;
    document.getElementById("userReceived").innerText = users[currentUser].received;
    document.getElementById("userReferral").innerText = users[currentUser].referral;
    document.getElementById("userWithdraw").innerText = users[currentUser].withdraw;
  }

  function makeDeposit() {
    let amt = parseFloat(document.getElementById("depositAmount").value);
    if (amt < 50 || amt > 500) return alert("Deposit must be between 50 and 500");
    users[currentUser].deposit += amt;
    users[currentUser].active = false;
    if (users[currentUser].refby && users[users[currentUser].refby]) {
      users[users[currentUser].refby].referral += amt * 0.05;
    }
    localStorage.setItem("users", JSON.stringify(users));
    showUserDashboard();
    alert("Deposit submitted. Wait for admin approval.");
  }

  function requestWithdraw() {
    let amt = parseFloat(document.getElementById("withdrawAmount").value);
    if (amt < 1) return alert("Minimum withdraw is 1 USDT");
    if ((users[currentUser].referral + users[currentUser].received) < amt)
      return alert("Insufficient balance");
    users[currentUser].withdraw += amt;
    users[currentUser].referral = 0;
    users[currentUser].received = 0;
    localStorage.setItem("users", JSON.stringify(users));
    showUserDashboard();
    alert("Withdrawal requested");
  }

  function renderAdmin() {
    let html = `<table class="admin-table"><tr><th>ID</th><th>Wallet</th><th>Deposit</th><th>Received</th><th>Referral</th><th>Withdraw</th><th>Status</th><th>Action</th></tr>`;
    for (let id in users) {
      let u = users[id];
      html += `<tr>
        <td>${id}</td><td>${u.wallet}</td><td>${u.deposit}</td><td>${u.received}</td>
        <td>${u.referral}</td><td>${u.withdraw}</td>
        <td>${u.active ? '✅' : '⏳'}</td>
        <td>
          ${!u.active && u.deposit > 0 ? `<button class="btn-small" onclick="approve('${id}')">Approve</button>` : ''}
          ${u.active && u.received < u.deposit * 2 ? `<button class="btn-small" onclick="pay('${id}')">Pay</button>` : ''}
        </td>
      </tr>`;
    }
    html += `</table>`;
    document.getElementById("adminData").innerHTML = html;
  }

  function approve(id) {
    users[id].active = true;
    localStorage.setItem("users", JSON.stringify(users));
    renderAdmin();
  }

  function pay(id) {
    let u = users[id];
    if (u.received < u.deposit * 2) {
      u.received += u.deposit * 0.10; // Weekly 10%
      if (u.received > u.deposit * 2) u.received = u.deposit * 2;
    }
    localStorage.setItem("users", JSON.stringify(users));
    renderAdmin();
  }

  if (location.search.includes("?r=")) {
    document.getElementById("refCode").value = location.search.split("?r=")[1];
  }
</script>

</body>
</html>
