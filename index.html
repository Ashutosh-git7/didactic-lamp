<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ashirwad Mini App</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 20px; }
    .card { background: white; padding: 15px; margin: 10px auto; border-radius: 10px; max-width: 400px; box-shadow: 0 0 10px #ccc; }
    input, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #28a745; color: white; border: none; }
    .link { color: #007bff; text-decoration: none; font-size: 14px; }
    .hide { display: none; }
  </style>
</head>
<body>

<div id="login" class="card">
  <h2>Login</h2>
  <input type="text" id="login_id" placeholder="User ID or Admin ID">
  <input type="password" id="login_pass" placeholder="Password">
  <button onclick="login()">Login</button>
  <p><a class="link" href="#" onclick="show('register')">New user? Register</a></p>
</div>

<div id="register" class="card hide">
  <h2>Register</h2>
  <input type="text" id="ref" placeholder="Referral code (optional)">
  <input type="text" id="wallet" placeholder="Your BEP20 Wallet Address">
  <input type="password" id="pass" placeholder="Set Password">
  <button onclick="register()">Register</button>
  <p><a class="link" href="#" onclick="show('login')">Back to Login</a></p>
</div>

<div id="userPanel" class="card hide">
  <h2>Welcome <span id="userName"></span></h2>
  <p>Your Wallet: <span id="userWallet"></span></p>
  <p>Referral Link: <span id="refLink"></span></p>
  <input type="number" id="amount" placeholder="Enter deposit (10 - 1000)">
  <button onclick="deposit()">Make Deposit</button>
  <h3>Your Deposits</h3>
  <ul id="myDeposits"></ul>
  <h3>Referral Income: $<span id="refIncome">0</span></h3>
  <button onclick="withdraw('ref')">Withdraw Referral</button>
  <h3>Interest Earned: $<span id="intIncome">0</span></h3>
  <button onclick="withdraw('int')">Withdraw Interest</button>
  <h3>Deposit Withdrawals</h3>
  <ul id="withdrawList"></ul>
  <button onclick="logout()">Logout</button>
</div>

<div id="adminPanel" class="card hide">
  <h2>Admin Panel</h2>
  <ul id="allUsers"></ul>
  <button onclick="logout()">Logout</button>
</div>

<script>
let db = {
  users: {},
  deposits: [],
  withdrawals: [],
  refCount: 1,
  admin: { id: 'admin', pass: 'admin123' }
};

let user = null;

function show(id) {
  ['login', 'register', 'userPanel', 'adminPanel'].forEach(p => {
    document.getElementById(p).classList.add('hide');
  });
  document.getElementById(id).classList.remove('hide');
}

function generateID() {
  let id = 'abc' + db.refCount++;
  while (db.users[id]) id = 'abc' + db.refCount++;
  return id;
}

function register() {
  const ref = document.getElementById('ref').value.trim().toLowerCase();
  const wallet = document.getElementById('wallet').value.trim();
  const pass = document.getElementById('pass').value;
  if (!wallet || !pass) return alert("All fields are required");
  const id = generateID();
  db.users[id] = {
    id, wallet, pass, deposits: [], referrals: [], refBy: ref, refEarnings: 0, interest: 0, created: Date.now()
  };
  if (db.users[ref]) db.users[ref].referrals.push(id);
  alert("Registered! Your ID: " + id);
  show('login');
}

function login() {
  const id = document.getElementById('login_id').value.trim();
  const pass = document.getElementById('login_pass').value;
  if (id === db.admin.id && pass === db.admin.pass) {
    show('adminPanel');
    loadAdmin();
    return;
  }
  if (!db.users[id] || db.users[id].pass !== pass) return alert("Invalid login");
  user = db.users[id];
  show('userPanel');
  document.getElementById('userName').innerText = user.id;
  document.getElementById('userWallet').innerText = user.wallet;
  document.getElementById('refLink').innerText = location.href.split('?')[0] + "?r=" + user.id;
  loadUser();
}

function deposit() {
  const amt = parseFloat(document.getElementById('amount').value);
  if (amt < 10 || amt > 1000) return alert("Amount must be between 10 and 1000");
  const d = { id: Date.now(), amt, user: user.id, date: Date.now(), approved: false };
  db.deposits.push(d);
  user.deposits.push(d.id);
  if (user.refBy && db.users[user.refBy]) {
    db.users[user.refBy].refEarnings += amt * 0.10;
  }
  alert("Deposit requested. Awaiting admin approval.");
  loadUser();
}

function withdraw(type) {
  if (type === 'ref') {
    if (user.refEarnings < 1) return alert("Min $1 to withdraw");
    db.withdrawals.push({ id: Date.now(), user: user.id, amt: user.refEarnings, type, date: Date.now(), approved: false });
    user.refEarnings = 0;
    alert("Referral withdrawal requested");
  } else if (type === 'int') {
    if (user.interest < 1) return alert("Min $1 to withdraw");
    db.withdrawals.push({ id: Date.now(), user: user.id, amt: user.interest, type, date: Date.now(), approved: false });
    user.interest = 0;
    alert("Interest withdrawal requested");
  }
  loadUser();
}

function loadUser() {
  const list = document.getElementById('myDeposits');
  list.innerHTML = '';
  user.deposits.forEach(did => {
    const dep = db.deposits.find(d => d.id === did);
    const days = Math.floor((Date.now() - dep.date) / (1000 * 60 * 60 * 24));
    let info = `Amount: $${dep.amt} | Day: ${days}`;
    if (dep.approved && days >= 30) {
      const monthly = Math.floor(days / 30);
      user.interest = monthly * dep.amt * 0.05;
    }
    list.innerHTML += `<li>${info} ${dep.approved ? "(Approved)" : "(Pending)"}</li>`;
  });
  document.getElementById('refIncome').innerText = user.refEarnings.toFixed(2);
  document.getElementById('intIncome').innerText = user.interest.toFixed(2);

  const wList = document.getElementById('withdrawList');
  wList.innerHTML = '';
  db.withdrawals.filter(w => w.user === user.id).forEach(w => {
    wList.innerHTML += `<li>${w.type} - $${w.amt} (${w.approved ? "Paid" : "Pending"})</li>`;
  });
}

function loadAdmin() {
  const ul = document.getElementById('allUsers');
  ul.innerHTML = '';
  Object.values(db.users).forEach(u => {
    ul.innerHTML += `<li><b>${u.id}</b> Wallet: ${u.wallet} Deposits: ${u.deposits.length} <button onclick="editUser('${u.id}')">Edit</button></li>`;
  });
}

function editUser(id) {
  const u = db.users[id];
  const newVal = prompt("Edit: wallet,refEarnings,interest", `${u.wallet},${u.refEarnings},${u.interest}`);
  const [w, r, i] = newVal.split(',');
  u.wallet = w;
  u.refEarnings = parseFloat(r);
  u.interest = parseFloat(i);
  alert("Updated");
  loadAdmin();
}

function logout() {
  user = null;
  show('login');
}
</script>
</body>
</html>
