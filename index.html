<!-- FULL FINAL BUG-FIXED HTML CODE FOR ASHIRWAD MART -->
<!DOCTYPE html>
<html>
<head>
  <title>ğŸš€ Ashirwad Mart - Grow Up Together</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f3f3f3; }
    h3 { color: #333; }
    .box { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px #ccc; }
    input, button, select { padding: 8px; margin: 5px 0; width: 100%; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #28a745; color: white; border: none; cursor: pointer; }
    button:hover { background: #218838; }
    .hide { display: none; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyCh0R0CzpuE4-Z5ej4k0Rx6PKa9lKn16Ak",
      authDomain: "ashirwadmart-6d657.firebaseapp.com",
      databaseURL: "https://ashirwadmart-6d657-default-rtdb.firebaseio.com",
      projectId: "ashirwadmart-6d657",
      storageBucket: "ashirwadmart-6d657.appspot.com",
      messagingSenderId: "476276294234",
      appId: "1:476276294234:web:6b2e8dfbcc5155c02b9bfc"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // UTILS
    function generateId() {
      return 'ID' + Math.random().toString(36).substr(2, 5);
    }

    function show(el) { el.classList.remove("hide"); }
    function hide(el) { el.classList.add("hide"); }

    function saveSession(uid) {
      localStorage.setItem("uid", uid);
    }

    function getSession() {
      return localStorage.getItem("uid");
    }

    function logout() {
      localStorage.removeItem("uid");
      location.reload();
    }

    // BUILD UI
    async function buildUI() {
      const uid = getSession();
      const app = document.getElementById("app");
      app.innerHTML = "";

      if (!uid) return loginUI();

      const snapshot = await db.ref("users/" + uid).get();
      const user = snapshot.val();

      if (!user) return loginUI();

      if (uid === "Admin") return adminUI();

      const totalIncome = (user.income || 0) + (user.withdrawn || 0);
      const remaining = (user.deposit || 0) * 2 - totalIncome;
      const status = totalIncome >= (user.deposit || 0) * 2 ? "Closed" : "Active";

      app.innerHTML = `
        <div class="box">
          <h3>ğŸ‘‹ Hello, ${user.name}</h3>
          ğŸ’¼ Wallet: ${user.wallet}<br>
          ğŸ’° Deposit: <b>${user.deposit || 0} USDT</b><br>
          ğŸ¯ Target (2x): <b>${(user.deposit || 0) * 2} USDT</b><br>
          ğŸ“¤ Withdrawn: <b>${user.withdrawn || 0} USDT</b><br>
          ğŸ“ˆ Income: <b>${user.income || 0} USDT</b><br>
          ğŸ’ Remaining: <b>${remaining} USDT</b><br>
          ğŸ”’ Status: ${status}<br>
        </div>
        <div class="box">
          <h3>ğŸ“¥ Deposit Funds</h3>
          Send 50â€“500 USDT to:<br>
          <code>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</code><br>
          <input id="depositAmount" type="number" placeholder="Enter Amount (50-500 USDT)" />
          <button onclick="submitDeposit()">Submit Deposit</button>
        </div>
        <div class="box">
          <h3>ğŸ’¸ Request Withdrawal</h3>
          <input id="withdrawAmount" type="number" placeholder="Enter Amount (Min 1 USDT)" />
          <button onclick="requestWithdrawal()">Request Withdrawal</button>
        </div>
        <div class="box">
          <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Referral Team</h3>
          <button onclick="viewTeam()">View Your Team</button>
        </div>
        <div class="box">
          <h3>ğŸ“œ History</h3>
          <button onclick="viewHistory()">View History</button>
        </div>
        <button onclick="logout()">ğŸšª Logout</button>
      `;
    }

    function loginUI() {
      const app = document.getElementById("app");
      app.innerHTML = `
        <div class="box">
          <h3>ğŸ” Login</h3>
          <input id="loginId" placeholder="Enter ID" />
          <button onclick="login()">Login</button><br>
          Don't have ID? <a href="#" onclick="registerUI()">Register here</a>
        </div>
      `;
    }

    function registerUI() {
      const app = document.getElementById("app");
      app.innerHTML = `
        <div class="box">
          <h3>ğŸ“ New Registration</h3>
          <input id="regName" placeholder="Your Name" />
          <input id="regMobile" placeholder="Mobile Number" />
          <input id="regWallet" placeholder="BEP20 USDT Address" />
          <input id="regRef" placeholder="Referral ID (optional)" />
          <button onclick="register()">Register Now</button>
        </div>
      `;
    }

    async function login() {
      const id = document.getElementById("loginId").value.trim();
      if (!id) return alert("Enter ID");

      const snapshot = await db.ref("users/" + id).get();
      if (!snapshot.exists()) return alert("ID not found");

      saveSession(id);
      buildUI();
    }

    async function register() {
      const name = document.getElementById("regName").value.trim();
      const mobile = document.getElementById("regMobile").value.trim();
      const wallet = document.getElementById("regWallet").value.trim();
      const ref = document.getElementById("regRef").value.trim();
      const id = generateId();

      if (!name || !mobile || !wallet) return alert("All fields required");

      await db.ref("users/" + id).set({
        name, mobile, wallet, ref, deposit: 0, income: 0, withdrawn: 0
      });

      if (ref) {
        const refSnap = await db.ref("referrals/" + ref).get();
        const team = refSnap.val() || [];
        team.push(id);
        await db.ref("referrals/" + ref).set(team);
      }

      alert("Registered. Your ID: " + id);
      saveSession(id);
      buildUI();
    }

    async function submitDeposit() {
      const uid = getSession();
      const amount = parseFloat(document.getElementById("depositAmount").value);
      if (isNaN(amount) || amount < 50 || amount > 500) return alert("Amount must be 50-500 USDT");

      await db.ref("deposits/" + uid).set({ amount, status: "Pending" });
      alert("Deposit submitted. Await admin approval.");
    }

    async function requestWithdrawal() {
      const uid = getSession();
      const amount = parseFloat(document.getElementById("withdrawAmount").value);
      if (isNaN(amount) || amount < 1) return alert("Minimum withdrawal is 1 USDT");

      const userSnap = await db.ref("users/" + uid).get();
      const user = userSnap.val();

      if ((user.income || 0) < amount) return alert("Insufficient balance");

      const wid = Date.now();
      await db.ref("withdrawals/" + uid + "/" + wid).set({
        amount,
        status: "Pending"
      });

      await db.ref("users/" + uid + "/income").set((user.income || 0) - amount);

      alert("Withdrawal request submitted.");
    }

    async function viewTeam() {
      const uid = getSession();
      const refSnap = await db.ref("referrals/" + uid).get();
      const team = refSnap.val() || [];
      alert("Your Team:\n" + team.join("\n"));
    }

    async function viewHistory() {
      const uid = getSession();
      const snap = await db.ref("withdrawals/" + uid).get();
      const data = snap.val() || {};
      let text = "Withdrawals:\n";
      for (let k in data) {
        text += `${data[k].amount} USDT - ${data[k].status}\n`;
      }
      alert(text);
    }

    function adminUI() {
      const app = document.getElementById("app");
      app.innerHTML = `
        <div class="box">
          <h3>ğŸ› ï¸ Admin Dashboard</h3>
          <input id="incomeId" placeholder="User ID" />
          <input id="incomeAmount" type="number" placeholder="Add Weekly Income" />
          <button onclick="addIncome()">Add Income</button>
          <br><br>
          <button onclick="logout()">ğŸšª Logout</button>
        </div>
      `;
    }

    async function addIncome() {
      const id = document.getElementById("incomeId").value.trim();
      const amt = parseFloat(document.getElementById("incomeAmount").value);
      if (!id || isNaN(amt)) return alert("Enter valid ID and amount");

      const userSnap = await db.ref("users/" + id).get();
      const user = userSnap.val();
      if (!user) return alert("User not found");

      const total = (user.income || 0) + (user.withdrawn || 0) + amt;
      const max = (user.deposit || 0) * 2;
      if (total > max) return alert("Cannot exceed 2x income");

      await db.ref("users/" + id + "/income").set((user.income || 0) + amt);
      alert("Income added.");
    }

    buildUI();
  </script>
</body>
</html>
