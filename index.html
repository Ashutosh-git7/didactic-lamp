<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ashirwad Signature App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f2f2f2; padding: 10px; }
    h2 { color: #333; }
    input, button, select { padding: 10px; margin: 5px 0; width: 100%; max-width: 350px; }
    .section { display: none; padding: 20px; background: white; border-radius: 10px; margin: auto; max-width: 400px; box-shadow: 0 0 10px #ccc; }
    .visible { display: block; }
    .hidden { display: none; }
    .btn { background: #0066cc; color: white; border: none; cursor: pointer; border-radius: 5px; }
    .box { margin-bottom: 20px; }
    .admin-section { background: #fefefe; padding: 15px; margin-top: 20px; border-radius: 10px; border: 1px solid #ddd; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>Ashirwad Signature App</h2>

  <!-- Registration -->
  <div id="registerSection" class="section visible">
    <h3>Register</h3>
    <input type="text" id="regName" placeholder="Your Name" required><br>
    <input type="text" id="regWallet" placeholder="Your USDT BEP20 Wallet" required><br>
    <button class="btn" onclick="register()">Register</button>
    <p>Already have ID? <a href="#" onclick="showSection('loginSection')">Login here</a></p>
  </div>

  <!-- Login -->
  <div id="loginSection" class="section">
    <h3>Login</h3>
    <input type="text" id="loginId" placeholder="Enter Your Ashirwad ID"><br>
    <button class="btn" onclick="login()">Login</button>
    <p>Don't have ID? <a href="#" onclick="showSection('registerSection')">Register</a></p>
  </div>

  <!-- User Dashboard -->
  <div id="dashboardSection" class="section">
    <h3>Welcome, <span id="userName"></span> (<span id="userId"></span>)</h3>
    <p><b>Wallet:</b> <span id="userWallet"></span></p>
    <p><b>Your Referral Link:</b> <span id="userReferral"></span></p>
    <div class="box">
      <h4>Make a Deposit</h4>
      <p>Send USDT to wallet:</p>
      <code>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</code>
      <input type="number" id="depositAmount" placeholder="Amount (10 - 1000)">
      <button class="btn" onclick="makeDeposit()">Submit Deposit</button>
    </div>
    <div class="box">
      <h4>Your Deposits</h4>
      <div id="depositList"></div>
    </div>
    <div class="box">
      <h4>Withdraw Earnings</h4>
      <button class="btn" onclick="requestInterestWithdrawal()">Withdraw Interest</button><br>
      <button class="btn" onclick="requestReferralWithdrawal()">Withdraw Referral</button>
      <div id="withdrawalResult"></div>
    </div>
    <div class="box">
      <button onclick="logout()" class="btn" style="background:red">Logout</button>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="adminLoginSection" class="section">
    <h3>Admin Login</h3>
    <input type="text" id="adminId" placeholder="Admin ID"><br>
    <input type="password" id="adminPass" placeholder="Password"><br>
    <button class="btn" onclick="adminLogin()">Login</button>
  </div>

  <div id="adminPanelSection" class="section">
    <h3>Admin Panel</h3>
    <div id="userTable"></div>
    <button onclick="logout()" class="btn" style="background:red">Logout</button>
        </div>
<script>
let currentUser = null;

// Utility functions
function showSection(id) {
  document.querySelectorAll('.section').forEach(div => div.classList.remove('visible'));
  document.getElementById(id).classList.add('visible');
}

function generateId() {
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const lastId = users.length ? parseInt(users[users.length - 1].id.replace('Ashirwad', '')) : 0;
  return 'Ashirwad' + String(lastId + 1).padStart(3, '0');
}

function register() {
  const name = document.getElementById('regName').value.trim();
  const wallet = document.getElementById('regWallet').value.trim();
  if (!name || !wallet) return alert("Enter all fields");

  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const id = generateId();
  const urlParams = new URLSearchParams(window.location.search);
  const ref = urlParams.get('r');

  const newUser = {
    id, name, wallet, password: '', deposits: [], interest: 0, referral: 0, referredBy: ref || '', requests: []
  };
  users.push(newUser);
  localStorage.setItem('users', JSON.stringify(users));
  alert(`Registered! Your ID: ${id}`);
  showSection('loginSection');
}

function login() {
  const id = document.getElementById('loginId').value.trim();
  if (id.toLowerCase() === 'admin') {
    showSection('adminLoginSection');
    return;
  }

  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const user = users.find(u => u.id.toLowerCase() === id.toLowerCase());
  if (!user) return alert("User not found");

  currentUser = user;
  updateDashboard();
  showSection('dashboardSection');
}

function logout() {
  currentUser = null;
  showSection('loginSection');
}

function updateDashboard() {
  document.getElementById('userName').innerText = currentUser.name;
  document.getElementById('userId').innerText = currentUser.id;
  document.getElementById('userWallet').innerText = currentUser.wallet;
  document.getElementById('userReferral').innerText = `${location.origin + location.pathname}?r=${currentUser.id.toLowerCase()}`;
  updateDepositList();
}

function makeDeposit() {
  const amount = parseFloat(document.getElementById('depositAmount').value);
  if (isNaN(amount) || amount < 10 || amount > 1000) return alert("Enter valid amount (10-1000)");

  const users = JSON.parse(localStorage.getItem('users'));
  const idx = users.findIndex(u => u.id === currentUser.id);

  users[idx].deposits.push({ amount, date: Date.now(), approved: false, interestWithdrawn: false, principalWithdrawn: false });
  
  // Referral bonus
  if (users[idx].referredBy) {
    const refUser = users.find(u => u.id.toLowerCase() === users[idx].referredBy.toLowerCase());
    if (refUser) refUser.referral += amount * 0.10;
  }

  localStorage.setItem('users', JSON.stringify(users));
  alert("Deposit request submitted!");
  currentUser = users[idx];
  updateDashboard();
}

function updateDepositList() {
  const div = document.getElementById('depositList');
  div.innerHTML = '';
  currentUser.deposits.forEach((d, i) => {
    const days = Math.floor((Date.now() - d.date) / (1000 * 60 * 60 * 24));
    const interest = (days >= 30 && d.approved && !d.interestWithdrawn) ? d.amount * 0.05 : 0;
    const withdrawable = (days >= 100 && d.approved && !d.principalWithdrawn) ? d.amount : 0;
    div.innerHTML += `<div>
      Amount: $${d.amount} | Days: ${days} | Approved: ${d.approved ? '✅' : '⏳'}
      ${interest ? `<br><button onclick="withdrawInterest(${i})">Withdraw Interest ($${interest.toFixed(2)})</button>` : ''}
      ${withdrawable ? `<br><button onclick="withdrawPrincipal(${i})">Withdraw Deposit ($${withdrawable})</button>` : ''}
    </div><hr>`;
  });
}

function withdrawInterest(index) {
  const users = JSON.parse(localStorage.getItem('users'));
  const user = users.find(u => u.id === currentUser.id);
  const deposit = user.deposits[index];
  const days = Math.floor((Date.now() - deposit.date) / (1000 * 60 * 60 * 24));
  if (days >= 30 && deposit.approved && !deposit.interestWithdrawn) {
    user.interest += deposit.amount * 0.05;
    deposit.interestWithdrawn = true;
    localStorage.setItem('users', JSON.stringify(users));
    currentUser = user;
    alert("Interest added to balance");
    updateDashboard();
  }
}

function withdrawPrincipal(index) {
  const users = JSON.parse(localStorage.getItem('users'));
  const user = users.find(u => u.id === currentUser.id);
  const deposit = user.deposits[index];
  const days = Math.floor((Date.now() - deposit.date) / (1000 * 60 * 60 * 24));
  if (days >= 100 && deposit.approved && !deposit.principalWithdrawn) {
    deposit.principalWithdrawn = true;
    localStorage.setItem('users', JSON.stringify(users));
    currentUser = user;
    alert("Deposit returned to wallet (admin will process)");
    updateDashboard();
  }
}

function requestInterestWithdrawal() {
  alert("Interest withdrawal sent. Admin will process.");
}
function requestReferralWithdrawal() {
  alert("Referral withdrawal sent. Admin will process.");
}

function adminLogin() {
  const id = document.getElementById('adminId').value.trim();
  const pass = document.getElementById('adminPass').value.trim();
  if (id === 'admin' && pass === 'admin123') {
    showSection('adminPanelSection');
    loadAdminPanel();
  } else {
    alert("Wrong credentials");
  }
}

function loadAdminPanel() {
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const div = document.getElementById('userTable');
  div.innerHTML = '';
  users.forEach((u, i) => {
    div.innerHTML += `<div class="admin-section">
      <b>${u.id}</b> - ${u.name}<br>
      Wallet: ${u.wallet}<br>
      Referral: ${u.referredBy}<br>
      Interest: $${u.interest.toFixed(2)} | Referral: $${u.referral.toFixed(2)}
      <br>Deposits:<br>
      ${u.deposits.map((d,j) => `
        $${d.amount} | ${Math.floor((Date.now()-d.date)/86400000)}d | Approved: ${d.approved}
        ${!d.approved ? `<button onclick="approveDeposit(${i},${j})">Approve</button>` : ''}
        <button onclick="rejectDeposit(${i},${j})">Reject</button>
      `).join('<br>')}
      <hr>
    </div>`;
  });
}

function approveDeposit(userIndex, depIndex) {
  const users = JSON.parse(localStorage.getItem('users'));
  users[userIndex].deposits[depIndex].approved = true;
  localStorage.setItem('users', JSON.stringify(users));
  loadAdminPanel();
}
function rejectDeposit(userIndex, depIndex) {
  const users = JSON.parse(localStorage.getItem('users'));
  users[userIndex].deposits.splice(depIndex, 1);
  localStorage.setItem('users', JSON.stringify(users));
  loadAdminPanel();
}
</script>
</body>
</html>
