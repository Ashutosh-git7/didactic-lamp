<!DOCTYPE html>
<html>
<head>
  <title>Ashirwad Mini App</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f3f3f3; }
    .box { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    input, button, select { width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #aaa; }
    h2 { text-align: center; }
    .hidden { display: none; }
    small { color: gray; }
  </style>
</head>
<body>

<div class="box" id="loginBox">
  <h2>User Login / Register</h2>
  <input type="text" id="ref" placeholder="Referral Code (optional)">
  <input type="text" id="wallet" placeholder="Your USDT Wallet Address (BEP20)">
  <button onclick="register()">Register</button>
  <input type="text" id="loginId" placeholder="Enter Your ANS ID">
  <button onclick="login()">Login</button>
</div>

<div class="box hidden" id="userBox">
  <h2>Welcome, <span id="userIdShow"></span></h2>
  <p><b>Referral Link:</b> <span id="refLink"></span></p>
  <p><b>Your Wallet:</b> <span id="walletShow"></span></p>

  <hr>
  <h3>Deposit USDT</h3>
  <p>Send $10–$1000 to:</p>
  <p><b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
  <input type="number" id="depositAmt" placeholder="Enter amount in USD">
  <button onclick="makeDeposit()">Submit Deposit</button>

  <hr>
  <h3>Your Balance</h3>
  <p>Deposited: $<span id="depAmt">0</span> (Approved: <span id="depStatus">❌</span>)</p>
  <p>Interest (5%/month after 30 days): $<span id="interestAmt">0</span></p>
  <p>Referral Income (10%): $<span id="refAmt">0</span></p>

  <hr>
  <h3>Withdraw</h3>
  <input type="number" id="withdrawAmt" placeholder="Enter withdrawal amount ($1 min)">
  <button onclick="requestWithdraw()">Request Withdraw</button>
  <p>Status: <span id="withdrawStatus">N/A</span></p>

  <hr>
  <h3>Referral Team</h3>
  <ul id="refList"></ul>

  <button onclick="logout()">Logout</button>
</div>

<div class="box" id="adminBox">
  <h2>Admin Login</h2>
  <input type="text" id="adminId" placeholder="Admin ID">
  <input type="password" id="adminPass" placeholder="Password">
  <button onclick="adminLogin()">Login</button>
</div>

<div class="box hidden" id="adminPanel">
  <h2>All Users</h2>
  <div id="allUsers"></div>
  <button onclick="logout()">Logout</button>
</div>

<script>
let users = JSON.parse(localStorage.getItem("users") || "{}");
let currentUser = null;
let adminLoggedIn = false;

function generateId() {
  return "ANS" + Math.random().toString(36).substr(2, 4);
}

function register() {
  const ref = document.getElementById("ref").value.trim();
  const wallet = document.getElementById("wallet").value.trim();
  if (!wallet) return alert("Please enter your wallet address.");
  const id = generateId();
  users[id] = { id, wallet, ref, depAmt: 0, depTime: null, depApproved: false, refAmt: 0, interest: 0, withdrawStatus: "N/A" };
  if (ref && users["ANS" + ref.toUpperCase()]) {
    let refId = "ANS" + ref.toUpperCase();
    users[refId].refAmt += 0; // bonus will be added on deposit approval
    if (!users[refId].team) users[refId].team = [];
    users[refId].team.push(id);
  }
  localStorage.setItem("users", JSON.stringify(users));
  alert("Registered. Your ID: " + id);
  document.getElementById("loginId").value = id;
}

function login() {
  const id = document.getElementById("loginId").value.trim();
  if (!users[id]) return alert("Invalid ID");
  currentUser = id;
  showUser();
}

function showUser() {
  const u = users[currentUser];
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("adminBox").classList.add("hidden");
  document.getElementById("userBox").classList.remove("hidden");
  document.getElementById("userIdShow").innerText = currentUser;
  document.getElementById("refLink").innerText = window.location.href.split('?')[0] + "?r=" + currentUser.slice(3).toLowerCase();
  document.getElementById("walletShow").innerText = u.wallet;
  document.getElementById("depAmt").innerText = u.depAmt;
  document.getElementById("depStatus").innerText = u.depApproved ? "✅" : "❌";
  document.getElementById("interestAmt").innerText = calcInterest(u);
  document.getElementById("refAmt").innerText = u.refAmt.toFixed(2);
  document.getElementById("withdrawStatus").innerText = u.withdrawStatus || "N/A";
  let list = u.team || [];
  document.getElementById("refList").innerHTML = list.map(id => "<li>" + id + "</li>").join("");
}

function makeDeposit() {
  const amt = parseFloat(document.getElementById("depositAmt").value);
  if (isNaN(amt) || amt < 10 || amt > 1000) return alert("Invalid amount");
  let u = users[currentUser];
  u.depAmt = amt;
  u.depApproved = false;
  u.depTime = Date.now();
  users[currentUser] = u;
  localStorage.setItem("users", JSON.stringify(users));
  alert("Deposit submitted. Wait for admin approval.");
  showUser();
}

function calcInterest(u) {
  if (!u.depApproved || !u.depTime) return 0;
  let days = (Date.now() - u.depTime) / (1000 * 60 * 60 * 24);
  if (days >= 30) return (u.depAmt * 0.05).toFixed(2);
  return "0.00";
}

function requestWithdraw() {
  const amt = parseFloat(document.getElementById("withdrawAmt").value);
  if (isNaN(amt) || amt < 1) return alert("Minimum $1 required");
  users[currentUser].withdrawStatus = "Pending $" + amt;
  localStorage.setItem("users", JSON.stringify(users));
  alert("Withdrawal request sent for admin approval.");
  showUser();
}

function logout() {
  currentUser = null;
  adminLoggedIn = false;
  document.getElementById("userBox").classList.add("hidden");
  document.getElementById("adminPanel").classList.add("hidden");
  document.getElementById("loginBox").classList.remove("hidden");
  document.getElementById("adminBox").classList.remove("hidden");
}

function adminLogin() {
  const id = document.getElementById("adminId").value.trim();
  const pass = document.getElementById("adminPass").value.trim();
  if (id === "Admin" && pass === "Jaihanuman@7") {
    adminLoggedIn = true;
    showAdminPanel();
  } else {
    alert("Wrong credentials");
  }
}

function showAdminPanel() {
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("adminBox").classList.add("hidden");
  document.getElementById("adminPanel").classList.remove("hidden");
  let html = "";
  for (let id in users) {
    const u = users[id];
    html += `<div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
      <b>${id}</b> | Wallet: ${u.wallet}<br>
      Deposit: $${u.depAmt} (${u.depApproved ? "✅" : "❌"})<br>
      <button onclick="approveDeposit('${id}')">Approve Deposit</button>
      <button onclick="editUser('${id}')">Edit</button><br>
      Interest: $${calcInterest(u)} | Referral: $${u.refAmt}<br>
      Withdraw: ${u.withdrawStatus || "N/A"} <button onclick="approveWithdraw('${id}')">Approve Withdraw</button>
    </div>`;
  }
  document.getElementById("allUsers").innerHTML = html;
}

function approveDeposit(id) {
  users[id].depApproved = true;
  localStorage.setItem("users", JSON.stringify(users));
  showAdminPanel();
}

function approveWithdraw(id) {
  users[id].withdrawStatus = "Approved";
  localStorage.setItem("users", JSON.stringify(users));
  showAdminPanel();
}

function editUser(id) {
  let newAmt = prompt("New deposit amount:", users[id].depAmt);
  if (newAmt !== null) users[id].depAmt = parseFloat(newAmt);
  localStorage.setItem("users", JSON.stringify(users));
  showAdminPanel();
}
</script>

</body>
</html>
