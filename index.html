<!DOCTYPE html>
<html>
<head>
  <title>Ashirwad 2X App</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; padding: 15px; }
    .box { max-width: 400px; margin: auto; border: 1px solid #ccc; border-radius: 8px; padding: 20px; }
    h2 { text-align: center; }
    input, button, select { width: 100%; margin: 8px 0; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
    .hide { display: none; }
    .logout-btn { background: crimson; color: white; }
    .approve-btn { background: green; color: white; margin-right: 5px; }
    .reject-btn { background: red; color: white; }
    table { width: 100%; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  </style>
</head>
<body>

<div class="box" id="authBox">
  <h2 id="authTitle">Register</h2>
  <input type="text" id="userId" placeholder="User ID (start with ANS)" />
  <input type="text" id="referral" placeholder="Referral Code (optional)" />
  <input type="text" id="wallet" placeholder="Your BEP20 Wallet Address" />
  <input type="password" id="pass" placeholder="Password" />
  <button onclick="register()">Register</button>
  <p style="text-align:center;">or</p>
  <button onclick="showLogin()">Already Registered? Login</button>
</div>

<div class="box hide" id="loginBox">
  <h2>Login</h2>
  <input type="text" id="loginId" placeholder="User ID" />
  <input type="password" id="loginPass" placeholder="Password" />
  <button onclick="login()">Login</button>
  <p style="text-align:center;">or</p>
  <button onclick="showRegister()">New? Register</button>
</div>

<div class="box hide" id="userBox">
  <h2>Welcome, <span id="userName"></span></h2>
  <p><b>Your Wallet:</b> <span id="userWallet"></span></p>
  <p><b>Your Referral:</b> <span id="userReferral"></span></p>
  <p><b>Your Balance:</b> <span id="userBalance">0</span> USDT</p>
  <input type="number" id="depositAmt" placeholder="Enter deposit (50-500 USDT)" />
  <button onclick="requestDeposit()">Request Deposit</button>
  <button onclick="requestWithdraw()">Request Withdraw</button>
  <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<div class="box hide" id="adminBox">
  <h2>Admin Panel</h2>
  <div id="adminContent"></div>
  <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<script>
let db = JSON.parse(localStorage.getItem('ashirwadUsers') || '{}');
let current = localStorage.getItem('ashirwadCurrent') || '';
let isAdmin = false;

function saveDB() {
  localStorage.setItem('ashirwadUsers', JSON.stringify(db));
}

function showLogin() {
  document.getElementById('authBox').classList.add('hide');
  document.getElementById('loginBox').classList.remove('hide');
}

function showRegister() {
  document.getElementById('loginBox').classList.add('hide');
  document.getElementById('authBox').classList.remove('hide');
}

function register() {
  let id = document.getElementById('userId').value.trim();
  let ref = document.getElementById('referral').value.trim();
  let wallet = document.getElementById('wallet').value.trim();
  let pass = document.getElementById('pass').value;

  if (!id.startsWith('ANS') || !wallet || !pass) return alert('Fill all details properly!');
  if (db[id]) return alert('User ID already exists!');
  
  db[id] = { pass, wallet, ref, bal: 0, deposits: [], income: 0, withdrawn: 0 };
  saveDB();
  alert('Registered successfully!');
  showLogin();
}

function login() {
  let id = document.getElementById('loginId').value.trim();
  let pass = document.getElementById('loginPass').value;

  if (id === 'Admin' && pass === 'Jaihanuman@7') {
    isAdmin = true;
    showAdmin();
    return;
  }

  if (!db[id] || db[id].pass !== pass) return alert('Invalid credentials!');
  current = id;
  localStorage.setItem('ashirwadCurrent', current);
  isAdmin = false;
  showUser();
}

function showUser() {
  if (!db[current]) return;
  document.getElementById('loginBox').classList.add('hide');
  document.getElementById('authBox').classList.add('hide');
  document.getElementById('userBox').classList.remove('hide');

  document.getElementById('userName').innerText = current;
  document.getElementById('userWallet').innerText = db[current].wallet;
  document.getElementById('userReferral').innerText = db[current].ref || 'None';
  document.getElementById('userBalance').innerText = db[current].bal.toFixed(2);
}

function requestDeposit() {
  let amt = parseFloat(document.getElementById('depositAmt').value);
  if (amt < 50 || amt > 500) return alert('Deposit must be between 50 and 500');

  db[current].deposits.push({ amt, status: 'Pending', given: 0 });
  if (db[current].ref && db[db[current].ref]) {
    db[db[current].ref].bal += amt * 0.05;
  }

  saveDB();
  alert('Deposit requested. Wait for admin approval.');
  showUser();
}

function requestWithdraw() {
  if (db[current].bal < 1) return alert('Minimum withdrawal: 1 USDT');
  db[current].withdrawn = (db[current].withdrawn || 0) + db[current].bal;
  db[current].bal = 0;
  saveDB();
  alert('Withdraw request sent. Admin will approve soon.');
  showUser();
}

function logout() {
  current = '';
  isAdmin = false;
  localStorage.removeItem('ashirwadCurrent');
  location.reload();
}

function showAdmin() {
  document.getElementById('loginBox').classList.add('hide');
  document.getElementById('authBox').classList.add('hide');
  document.getElementById('adminBox').classList.remove('hide');

  let html = '<h3>User Records</h3><table><tr><th>User</th><th>Wallet</th><th>Balance</th><th>Deposits</th><th>Action</th></tr>';
  for (let uid in db) {
    let u = db[uid];
    html += `<tr><td>${uid}</td><td>${u.wallet}</td><td>${u.bal.toFixed(2)}</td><td>${u.deposits.map((d, i) =>
      `#${i+1}: ${d.amt} (${d.status})`).join('<br>')}</td>
      <td>${u.deposits.map((d, i) =>
        d.status === 'Pending' ? `<button class='approve-btn' onclick="approve('${uid}',${i})">Approve</button>` : ''
      ).join('')}</td></tr>`;
  }
  html += '</table>';
  document.getElementById('adminContent').innerHTML = html;
}

function approve(uid, index) {
  let d = db[uid].deposits[index];
  if (!d || d.status !== 'Pending') return;
  d.status = 'Approved';
  saveDB();
  alert('Deposit approved! You can now start giving weekly income.');
  showAdmin();
}
</script>

</body>
</html>
