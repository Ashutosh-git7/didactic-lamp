<!DOCTYPE html>
<html>
<head>
  <title>Ashirwad Mart</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; background: #f9f9f9; }
    h2 { color: #2e7d32; }
    input, button, select { margin: 5px 0; padding: 8px; width: 100%; max-width: 300px; }
    .hidden { display: none; }
    .box { background: #fff; border-radius: 8px; padding: 15px; margin: 10px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <h2>Ashirwad Mart</h2>
  <div id="auth" class="box">
    <input id="name" placeholder="Name" />
    <input id="mobile" placeholder="Mobile Number" />
    <input id="wallet" placeholder="Your USDT BEP20 Wallet Address" />
    <input id="ref" placeholder="Referral Code (optional)" />
    <button onclick="register()">Register</button>
    <hr>
    <input id="loginMobile" placeholder="Login Mobile" />
    <button onclick="login()">Login</button>
  </div>

  <div id="userPanel" class="box hidden">
    <h3>Welcome, <span id="userName"></span></h3>
    <p>Referral Code: <b id="refCode"></b></p>
    <p>Your BEP20 Wallet: <span id="userWallet"></span></p>
    <p>Total Deposit: $<span id="totalDeposit">0</span></p>
    <p>Total Income: $<span id="totalIncome">0</span></p>
    <p>Referral Income: $<span id="refIncome">0</span></p>
    <p>Income Wallet: $<span id="incomeWallet">0</span></p>
    <p>Agreement: <span id="agreementStatus">Active</span></p>

    <input id="depositAmount" placeholder="Deposit 50â€“500" type="number" />
    <button onclick="submitDeposit()">Submit Deposit</button>

    <button onclick="requestWithdraw()">Request Withdrawal</button>

    <h4>Deposit History</h4>
    <ul id="depositHistory"></ul>

    <h4>Withdrawal History</h4>
    <ul id="withdrawHistory"></ul>

    <h4>Your Team</h4>
    <ul id="teamList"></ul>

    <button onclick="logout()">Logout</button>
  </div>

  <div id="adminPanel" class="box hidden">
    <h3>Admin Panel</h3>
    <div id="adminLogin">
      <input id="adminId" placeholder="Admin ID" />
      <input id="adminPass" placeholder="Admin Password" type="password" />
      <button onclick="adminLogin()">Login</button>
    </div>
    <div id="adminSection" class="hidden">
      <button onclick="loadAllUsers()">Load Users</button>
      <div id="userList"></div>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBJ7UXEgTvmq94IgrODtWj91S12pZyGABs",
    authDomain: "ashirwadmart-6d657.firebaseapp.com",
    databaseURL: "https://ashirwadmart-6d657-default-rtdb.firebaseio.com",
    projectId: "ashirwadmart-6d657",
    storageBucket: "ashirwadmart-6d657.appspot.com",
    messagingSenderId: "1006856757065",
    appId: "1:1006856757065:web:46bd7c028e7f38d71b6ff6"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = null;
  function register() {
    const name = document.getElementById('name').value;
    const mobile = document.getElementById('mobile').value;
    const wallet = document.getElementById('wallet').value;
    const ref = document.getElementById('ref').value;
    if (!name || !mobile || !wallet) return alert("All fields required");
    const userId = "u" + Date.now();
    db.ref("users/" + mobile).set({
      name, mobile, wallet, ref, userId,
      deposit: 0, income: 0, refIncome: 0,
      agreement: true,
      withdraws: [], deposits: [], team: []
    }).then(() => {
      alert("Registered!");
      login();
    });
  }

  function login() {
    const mobile = document.getElementById('loginMobile').value || document.getElementById('mobile').value;
    db.ref("users/" + mobile).once('value', snap => {
      if (!snap.exists()) return alert("User not found");
      currentUser = snap.val();
      document.getElementById("auth").classList.add("hidden");
      document.getElementById("userPanel").classList.remove("hidden");
      loadUserPanel();
    });
  }

  function logout() {
    location.reload();
  }

  function loadUserPanel() {
    document.getElementById("userName").innerText = currentUser.name;
    document.getElementById("refCode").innerText = currentUser.userId;
    document.getElementById("userWallet").innerText = currentUser.wallet;
    document.getElementById("totalDeposit").innerText = currentUser.deposit || 0;
    document.getElementById("totalIncome").innerText = currentUser.income || 0;
    document.getElementById("refIncome").innerText = currentUser.refIncome || 0;
    document.getElementById("incomeWallet").innerText = (currentUser.income + currentUser.refIncome) || 0;
    document.getElementById("agreementStatus").innerText = currentUser.agreement ? "Active" : "Closed";

    const team = currentUser.team || [];
    document.getElementById("teamList").innerHTML = team.map(x => `<li>${x}</li>`).join("");

    db.ref("users/" + currentUser.mobile + "/deposits").once('value', snap => {
      const list = [];
      snap.forEach(child => {
        list.push(`<li>${child.val().amount} USDT - ${child.val().status}</li>`);
      });
      document.getElementById("depositHistory").innerHTML = list.join("");
    });

    db.ref("users/" + currentUser.mobile + "/withdraws").once('value', snap => {
      const list = [];
      snap.forEach(child => {
        list.push(`<li>${child.val().amount} USDT - ${child.val().status}</li>`);
      });
      document.getElementById("withdrawHistory").innerHTML = list.join("");
    });
  }

  function submitDeposit() {
    const amt = parseInt(document.getElementById("depositAmount").value);
    if (amt < 50 || amt > 500) return alert("Amount must be between 50-500");
    const key = db.ref().push().key;
    db.ref("users/" + currentUser.mobile + "/deposits/" + key).set({
      amount: amt, status: "pending"
    }).then(() => alert("Deposit submitted"));
  }

  function requestWithdraw() {
    const totalIncome = (currentUser.income || 0) + (currentUser.refIncome || 0);
    if (totalIncome < 1) return alert("Minimum $1 required");
    const key = db.ref().push().key;
    db.ref("users/" + currentUser.mobile + "/withdraws/" + key).set({
      amount: totalIncome, status: "pending"
    });
    db.ref("users/" + currentUser.mobile).update({ income: 0, refIncome: 0 });
    alert("Withdrawal requested!");
  }

  function adminLogin() {
    const id = document.getElementById("adminId").value;
    const pass = document.getElementById("adminPass").value;
    if (id === "Admin" && pass === "Jaihanuman@7") {
      document.getElementById("adminLogin").classList.add("hidden");
      document.getElementById("adminSection").classList.remove("hidden");
    } else alert("Invalid credentials");
  }

  function loadAllUsers() {
    db.ref("users").once('value', snap => {
      const list = [];
      snap.forEach(child => {
        const u = child.val();
        list.push(`<div class='box'>
          <b>${u.name} (${u.mobile})</b><br>
          Wallet: ${u.wallet}<br>
          Deposit: ${u.deposit || 0}, Income: ${u.income || 0}<br>
          Agreement: ${u.agreement ? "Active" : "Closed"}<br>
          <button onclick="approveDeposit('${u.mobile}', 100)">+100 Income</button>
          <button onclick="closeAgreement('${u.mobile}')">Close</button>
        </div>`);
      });
      document.getElementById("userList").innerHTML = list.join("");
    });
  }

  function approveDeposit(mobile, amount) {
    db.ref("users/" + mobile + "/income").once('value', snap => {
      let inc = snap.val() || 0;
      let newInc = inc + amount;
      db.ref("users/" + mobile + "/income").set(newInc);
      alert("Income added");
    });
  }

  function closeAgreement(mobile) {
    db.ref("users/" + mobile).update({ agreement: false });
    alert("Agreement closed");
  }
</script>
</body>
</html>
