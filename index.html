<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ashirwad Mini App</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f7f7f7; color: #333; }
    .hide { display: none; }
    input, button { padding: 8px; margin: 5px 0; width: 100%; max-width: 300px; }
    #userPanel, #adminPanel { margin-top: 20px; }
    .section { background: #fff; padding: 15px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 0 5px #ccc; }
    h2 { color: #007BFF; }
    a { word-break: break-all; }
  </style>
</head>
<body>
  <h1>ðŸŒŸ Ashirwad Mini App</h1>

  <div id="loginSection" class="section">
    <h2>Login</h2>
    <input id="loginId" placeholder="User ID or Admin">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p><a href="#" onclick="showRegister()">New user? Register here</a></p>
  </div>

  <div id="registerSection" class="section hide">
    <h2>Register</h2>
    <input id="regName" placeholder="Your Name">
    <input id="regWallet" placeholder="Your USDT BEP20 Wallet">
    <input id="regPass" type="password" placeholder="Password">
    <button onclick="register()">Register</button>
    <p><a href="#" onclick="showLogin()">Already registered? Login</a></p>
  </div>

  <div id="userPanel" class="section hide">
    <h2>ðŸ‘¤ Welcome, <span id="userName"></span></h2>
    <p><b>ID:</b> <span id="userID"></span></p>
    <p><b>Wallet:</b> <span id="userWallet"></span></p>
    <p><b>Referral Link:</b> <input id="refLink" readonly></p>

    <div class="section">
      <h3>Deposit</h3>
      <input id="depAmt" type="number" placeholder="Enter deposit amount ($10 - $1000)">
      <p>Send to: <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
      <button onclick="requestDeposit()">Submit Deposit</button>
    </div>

    <div class="section">
      <h3>Withdrawals</h3>
      <button onclick="requestInterestWithdraw()">Withdraw Interest</button>
      <button onclick="requestReferralWithdraw()">Withdraw Referral</button>
      <button onclick="requestPrincipalWithdraw()">Withdraw Principal</button>
      <p id="withdrawMsg"></p>
    </div>

    <div class="section">
      <h3>Deposit History</h3>
      <div id="depList"></div>
    </div>

    <div class="section">
      <h3>Your Team</h3>
      <div id="teamList"></div>
    </div>
  </div>

  <div id="adminPanel" class="section hide">
    <h2>ðŸ”’ Admin Panel</h2>
    <div id="adminData"></div>
  </div>

<script>
let users = JSON.parse(localStorage.getItem("users") || "{}");
let currentUser = null;

const loginSection = document.getElementById("loginSection");
const registerSection = document.getElementById("registerSection");
const userPanel = document.getElementById("userPanel");
const adminPanel = document.getElementById("adminPanel");

const userName = document.getElementById("userName");
const userID = document.getElementById("userID");
const userWallet = document.getElementById("userWallet");
const refLink = document.getElementById("refLink");
const depList = document.getElementById("depList");
const teamList = document.getElementById("teamList");
const depAmt = document.getElementById("depAmt");
const withdrawMsg = document.getElementById("withdrawMsg");
const adminData = document.getElementById("adminData");

function getQueryParam(key) {
  return new URLSearchParams(window.location.search).get(key);
}

function showLogin() {
  registerSection.classList.add("hide");
  loginSection.classList.remove("hide");
}

function showRegister() {
  loginSection.classList.add("hide");
  registerSection.classList.remove("hide");
}

function login() {
  let id = document.getElementById("loginId").value.trim();
  let pass = document.getElementById("loginPass").value.trim();

  if (id === "Admin" && pass === "Jaihanuman@7") return showAdminPanel();

  if (users[id] && users[id].password === pass) {
    currentUser = id;
    showUserPanel();
  } else {
    alert("Invalid credentials");
  }
}

function register() {
  let name = document.getElementById("regName").value.trim();
  let wallet = document.getElementById("regWallet").value.trim();
  let pass = document.getElementById("regPass").value.trim();
  if (!name || !wallet || !pass) return alert("All fields required");

  let id = "ash" + Math.random().toString(36).substring(2, 6);
  while (users[id]) id = "ash" + Math.random().toString(36).substring(2, 6);

  let ref = getQueryParam("r");

  users[id] = {
    id, name, wallet, password: pass,
    refBy: ref || null,
    deposits: [],
    interest: 0,
    referral: 0,
    team: []
  };

  if (ref && users[ref]) users[ref].team.push(id);

  currentUser = id;
  save();
  showUserPanel();
}

function showUserPanel() {
  loginSection.classList.add("hide");
  registerSection.classList.add("hide");
  userPanel.classList.remove("hide");
  adminPanel.classList.add("hide");

  let u = users[currentUser];
  userName.textContent = u.name;
  userID.textContent = u.id;
  userWallet.textContent = u.wallet;
  refLink.value = location.href.split("?")[0] + "?r=" + u.id;

  updateUserDepositList();
  showTeamList();
}

function updateUserDepositList() {
  let u = users[currentUser];
  let html = "";
  u.deposits.forEach((d, i) => {
    html += `<p>#${i+1}: $${d.amount} | ${d.status} | ${d.date}</p>`;
  });
  depList.innerHTML = html || "No deposits";
}

function showTeamList() {
  let team = users[currentUser].team;
  let html = team.map(id => `<p>${id} - ${users[id].name}</p>`).join("");
  teamList.innerHTML = html || "No referrals yet";
}

function requestDeposit() {
  let amt = parseFloat(depAmt.value);
  if (amt < 10 || amt > 1000) return alert("Amount must be between $10-$1000");

  users[currentUser].deposits.push({
    amount: amt,
    date: new Date().toLocaleDateString(),
    timestamp: Date.now(),
    status: "pending",
    type: "deposit"
  });

  let ref = users[currentUser].refBy;
  if (ref && users[ref]) {
    users[ref].referral += amt * 0.10;
  }

  save();
  alert("Deposit request submitted.");
  updateUserDepositList();
}

function requestInterestWithdraw() {
  let u = users[currentUser];
  let total = 0;
  u.deposits.forEach(d => {
    if (d.status === "approved" && Date.now() - d.timestamp >= 30*24*60*60*1000) {
      total += d.amount * 0.05;
    }
  });

  if (total < 1) return alert("Not enough interest");
  u.interest += total;
  addWithdrawal(currentUser, total, "interest");
  save();
  withdrawMsg.textContent = "Interest withdrawal requested.";
}

function requestReferralWithdraw() {
  let u = users[currentUser];
  if (u.referral < 1) return alert("Not enough referral income");
  addWithdrawal(currentUser, u.referral, "referral");
  u.referral = 0;
  save();
  withdrawMsg.textContent = "Referral withdrawal requested.";
}

function requestPrincipalWithdraw() {
  let u = users[currentUser];
  let total = 0;
  u.deposits.forEach((d, i) => {
    if (d.status === "approved" && !d.withdrawn && Date.now() - d.timestamp >= 100*24*60*60*1000) {
      total += d.amount;
      u.deposits[i].withdrawn = true;
    }
  });

  if (total < 1) return alert("Nothing eligible to withdraw");
  addWithdrawal(currentUser, total, "principal");
  save();
  withdrawMsg.textContent = "Principal withdrawal requested.";
}

function addWithdrawal(uid, amt, type) {
  if (!users[uid].withdrawals) users[uid].withdrawals = [];
  users[uid].withdrawals.push({
    amount: amt,
    type,
    status: "pending",
    date: new Date().toLocaleDateString()
  });
}

function showAdminPanel() {
  loginSection.classList.add("hide");
  registerSection.classList.add("hide");
  userPanel.classList.add("hide");
  adminPanel.classList.remove("hide");

  let html = "";
  Object.values(users).forEach(u => {
    html += `<div><h3>${u.id} - ${u.name}</h3>`;

    u.deposits.forEach((d, i) => {
      html += `<p>Deposit #${i+1}: $${d.amount} | ${d.status} 
      <button onclick="approveDeposit('${u.id}',${i})">Approve</button></p>`;
    });

    (u.withdrawals || []).forEach((w, i) => {
      html += `<p>Withdraw #${i+1}: $${w.amount} (${w.type}) | ${w.status} 
      <button onclick="approveWithdraw('${u.id}',${i})">Approve</button></p>`;
    });

    html += `<p>Wallet: ${u.wallet}</p><hr/></div>`;
  });

  adminData.innerHTML = html || "No data.";
}

function approveDeposit(uid, index) {
  users[uid].deposits[index].status = "approved";
  save();
  showAdminPanel();
}

function approveWithdraw(uid, index) {
  users[uid].withdrawals[index].status = "approved";
  save();
  showAdminPanel();
}

function save() {
  localStorage.setItem("users", JSON.stringify(users));
}
</script>
</body>
</html>
