<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ashirwad Mini App</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f5f5f5; }
    .box { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, button, select { width: 100%; padding: 10px; margin: 8px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { background: #007bff; color: #fff; border: none; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 14px; }
    .admin-btn { width: 48%; display: inline-block; margin: 1%; }
  </style>
</head>
<body>
<div class="box">
  <div id="auth">
    <h2>Register</h2>
    <input id="regName" placeholder="Your Name" />
    <input id="regPass" placeholder="Password" type="password" />
    <button onclick="register()">Register</button>

    <h2>Login</h2>
    <input id="loginName" placeholder="Your Name" />
    <input id="loginPass" placeholder="Password" type="password" />
    <button onclick="login()">Login</button>
    <button onclick="adminLogin()">Admin Login</button>
  </div>

  <div id="userPanel" class="hidden">
    <h2>Welcome <span id="userName"></span></h2>
    <p>Your ID: <span id="userId"></span></p>
    <input id="wallet" placeholder="Your USDT BEP20 Wallet" />
    <button onclick="saveWallet()">ðŸ’¾ Save Wallet</button>
    <p>Referral link: <span id="refLink"></span></p>
    <h3>Make a Deposit</h3>
    <input id="amount" type="number" placeholder="Amount (10-1000 USDT)" />
    <p>Send USDT to:</p>
    <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b>
    <button onclick="submitDeposit()">Submit Deposit</button>
    <h3>Withdraw (After 100 Days)</h3>
    <button onclick="requestWithdrawal()">Request Withdrawal</button>

    <h3>Your Deposits</h3>
    <div id="deposits"></div>

    <h3>Your Team</h3>
    <div id="team"></div>

    <button onclick="logout()">ðŸšª Logout</button>
  </div>

  <div id="adminPanel" class="hidden">
    <h2>Admin Panel</h2>
    <div id="adminData"></div>
    <button onclick="logout()">ðŸšª Logout</button>
  </div>
</div>

<script>
let users = JSON.parse(localStorage.getItem("users") || "[]");
let deposits = JSON.parse(localStorage.getItem("deposits") || "[]");
let withdrawals = JSON.parse(localStorage.getItem("withdrawals") || "[]");
let current = localStorage.getItem("currentUser");

function saveAll() {
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("deposits", JSON.stringify(deposits));
  localStorage.setItem("withdrawals", JSON.stringify(withdrawals));
}

function generateId() {
  let id = 1001;
  while (users.find(u => u.id === "USR" + id)) id++;
  return "USR" + id;
}

function register() {
  const name = document.getElementById("regName").value.trim();
  const pass = document.getElementById("regPass").value.trim();
  if (!name || !pass) return alert("Fill all fields");
  if (users.find(u => u.name === name)) return alert("User already exists");

  const urlParams = new URLSearchParams(window.location.search);
  const ref = urlParams.get("ref");

  const id = generateId();
  users.push({ id, name, pass, wallet: "", ref });
  saveAll();
  alert("Registered! Please login.");
}

function login() {
  const name = document.getElementById("loginName").value.trim();
  const pass = document.getElementById("loginPass").value.trim();
  const user = users.find(u => u.name === name && u.pass === pass);
  if (!user) return alert("Invalid credentials");
  localStorage.setItem("currentUser", user.id);
  showUserPanel();
}

function adminLogin() {
  const name = document.getElementById("loginName").value.trim();
  const pass = document.getElementById("loginPass").value.trim();
  if (name === "admin" && pass === "admin123") {
    document.getElementById("auth").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
    renderAdmin();
  } else {
    alert("Invalid admin credentials");
  }
}

function showUserPanel() {
  current = localStorage.getItem("currentUser");
  if (!current) return;
  const user = users.find(u => u.id === current);
  if (!user) return;
  document.getElementById("auth").classList.add("hidden");
  document.getElementById("userPanel").classList.remove("hidden");
  document.getElementById("userName").innerText = user.name;
  document.getElementById("userId").innerText = user.id;
  document.getElementById("refLink").innerText = location.href.split("?")[0] + "?ref=" + user.id;
  renderDeposits();
  renderTeam();
}

function logout() {
  localStorage.removeItem("currentUser");
  location.reload();
}

function saveWallet() {
  const wallet = document.getElementById("wallet").value.trim();
  const user = users.find(u => u.id === current);
  if (!wallet || !user) return alert("Enter wallet");
  user.wallet = wallet;
  saveAll();
  alert("Wallet saved");
}

function submitDeposit() {
  const amt = parseFloat(document.getElementById("amount").value);
  if (amt < 10 || amt > 1000) return alert("Amount must be 10-1000");
  deposits.push({ id: current, amount: amt, status: "pending", date: new Date().toISOString() });
  saveAll();
  alert("Deposit submitted. Wait for admin approval.");
  renderDeposits();
}

function renderDeposits() {
  const html = deposits
    .filter(d => d.id === current)
    .map(d => `<p>${d.amount} USDT - ${d.status}</p>`).join("");
  document.getElementById("deposits").innerHTML = html || "No deposits";
}

function renderTeam() {
  const team = users.filter(u => u.ref === current);
  const html = team.map(t => `<p>${t.name} (${t.id})</p>`).join("");
  document.getElementById("team").innerHTML = html || "No team members";
}

function requestWithdrawal() {
  withdrawals.push({ id: current, status: "pending", date: new Date().toISOString() });
  saveAll();
  alert("Withdrawal requested. Admin will approve.");
}

function renderAdmin() {
  const html = users.map(u => {
    const userDeposits = deposits.filter(d => d.id === u.id).map((d, i) =>
      `<tr><td>${u.id}</td><td>${d.amount}</td><td>${d.status}</td>
      <td><button onclick="approveDeposit(${deposits.indexOf(d)})">Approve</button>
      <button onclick="rejectDeposit(${deposits.indexOf(d)})">Reject</button></td></tr>`).join("");

    const userWithdrawals = withdrawals.filter(w => w.id === u.id).map(w =>
      `<tr><td>${u.id}</td><td>${w.status}</td>
      <td><button onclick="approveWithdrawal(${withdrawals.indexOf(w)})">Approve</button>
      <button onclick="rejectWithdrawal(${withdrawals.indexOf(w)})">Reject</button></td></tr>`).join("");

    return `
      <h4>${u.name} (${u.id})</h4>
      <p>Wallet: ${u.wallet}</p>
      <table><tr><th colspan="4">Deposits</th></tr>${userDeposits}</table>
      <table><tr><th colspan="3">Withdrawals</th></tr>${userWithdrawals}</table>
    `;
  }).join("");
  document.getElementById("adminData").innerHTML = html;
}

function approveDeposit(i) { deposits[i].status = "approved"; saveAll(); renderAdmin(); }
function rejectDeposit(i) { deposits[i].status = "rejected"; saveAll(); renderAdmin(); }
function approveWithdrawal(i) { withdrawals[i].status = "paid"; saveAll(); renderAdmin(); }
function rejectWithdrawal(i) { withdrawals[i].status = "rejected"; saveAll(); renderAdmin(); }

if (current) showUserPanel();
</script>
</body>
</html>
