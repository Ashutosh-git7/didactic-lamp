<!DOCTYPE html>
<html>
<head>
  <title>2X USDT Plan</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { font-family: sans-serif; margin: 10px; background: #f7f7f7; }
    .card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 0 10px #ccc; }
    input, button, select { padding: 10px; margin-top: 5px; width: 100%; border-radius: 8px; border: 1px solid #aaa; }
    .hidden { display: none; }
    .admin-only { background: #fffbe6; }
    .btn { background: #0066cc; color: white; border: none; cursor: pointer; }
    .btn-red { background: #cc0000; }
    .btn-green { background: #28a745; }
  </style>
</head>
<body>

<div id="app" class="card">
  <div id="registerSection">
    <h2>Register</h2>
    <input type="text" id="regName" placeholder="Your Name" />
    <input type="text" id="regWallet" placeholder="Your BEP20 Wallet (for withdrawal)" />
    <input type="text" id="regPassword" placeholder="Password" />
    <button class="btn" onclick="register()">Register</button>
    <p>Already have account? <a href="#" onclick="showLogin()">Login</a></p>
  </div>

  <div id="loginSection" class="hidden">
    <h2>Login</h2>
    <input type="text" id="loginName" placeholder="Your Name" />
    <input type="password" id="loginPassword" placeholder="Password" />
    <button class="btn" onclick="login()">Login</button>
    <p>Don't have account? <a href="#" onclick="showRegister()">Register</a></p>
  </div>

  <div id="userDashboard" class="hidden">
    <h2>Welcome, <span id="userName"></span></h2>
    <p><b>Your Wallet:</b> <span id="userWallet"></span></p>
    <p><b>Referral Link:</b> <span id="refLink"></span></p>

    <div class="card">
      <h3>Make a Deposit</h3>
      <p>Send USDT (BEP20) to:</p>
      <p><b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
      <input type="number" id="depositAmount" placeholder="Enter Amount (50 - 500)" />
      <button class="btn" onclick="makeDeposit()">Submit Deposit</button>
    </div>

    <div class="card">
      <h3>Your Status</h3>
      <p><b>Total Deposit:</b> $<span id="userDeposit">0</span></p>
      <p><b>Total Income:</b> $<span id="userIncome">0</span></p>
      <p><b>Referral Income:</b> $<span id="refIncome">0</span></p>
      <p><b>Total Withdrawn:</b> $<span id="withdrawn">0</span></p>
      <button class="btn-green" onclick="withdraw()">Withdraw Now</button>
    </div>

    <button class="btn-red" onclick="logout()">Logout</button>
  </div>

  <div id="adminPanel" class="hidden card admin-only">
    <h2>Admin Panel</h2>
    <div>
      <input type="text" id="adminUser" placeholder="Username" />
      <input type="password" id="adminPass" placeholder="Password" />
      <button class="btn" onclick="adminLogin()">Login</button>
    </div>
    <div id="adminDashboard" class="hidden">
      <h3>All Users</h3>
      <div id="userList"></div>
    </div>
  </div>
</div>

<script>
  let users = JSON.parse(localStorage.getItem("users") || "{}");
  let currentUser = null;
  let ref = new URLSearchParams(location.search).get("r");

  function saveUsers() {
    localStorage.setItem("users", JSON.stringify(users));
  }

  function showLogin() {
    document.getElementById("registerSection").classList.add("hidden");
    document.getElementById("loginSection").classList.remove("hidden");
  }

  function showRegister() {
    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("registerSection").classList.remove("hidden");
  }

  function register() {
    let name = regName.value.trim().toLowerCase();
    let wallet = regWallet.value.trim();
    let pass = regPassword.value.trim();
    if (!name || !wallet || !pass) return alert("All fields required");
    if (users[name]) return alert("User already exists");
    users[name] = {
      pass, wallet, deposit: 0, income: 0, refIncome: 0, withdrawn: 0, refBy: ref || "", active: false
    };
    if (ref && users[ref]) users[ref].refIncome += 0;
    saveUsers();
    alert("Registered! Now login.");
    showLogin();
  }

  function login() {
    let name = loginName.value.trim().toLowerCase();
    let pass = loginPassword.value.trim();
    if (!users[name] || users[name].pass !== pass) return alert("Invalid login");
    currentUser = name;
    showDashboard();
  }

  function logout() {
    currentUser = null;
    location.reload();
  }

  function showDashboard() {
    document.getElementById("registerSection").classList.add("hidden");
    document.getElementById("loginSection").classList.add("hidden");
    document.getElementById("userDashboard").classList.remove("hidden");

    let u = users[currentUser];
    userName.innerText = currentUser;
    userWallet.innerText = u.wallet;
    userDeposit.innerText = u.deposit;
    userIncome.innerText = u.income;
    refIncome.innerText = u.refIncome;
    withdrawn.innerText = u.withdrawn;
    refLink.innerText = location.href.split("?")[0] + "?r=" + currentUser;
  }

  function makeDeposit() {
    let amt = parseFloat(depositAmount.value);
    if (amt < 50 || amt > 500) return alert("Deposit must be between 50 to 500 USDT");
    users[currentUser].pendingDeposit = amt;
    saveUsers();
    alert("Deposit submitted! Admin will approve soon.");
  }

  function withdraw() {
    let u = users[currentUser];
    let totalBal = u.income + u.refIncome;
    if (totalBal < 1) return alert("Minimum withdrawal is 1 USDT");
    u.withdrawn += totalBal;
    u.income = 0;
    u.refIncome = 0;
    saveUsers();
    alert("Withdrawal request submitted!");
    showDashboard();
  }

  function adminLogin() {
    if (adminUser.value === "admin" && adminPass.value === "Jaihanuman@7") {
      document.getElementById("adminDashboard").classList.remove("hidden");
      listUsers();
    } else {
      alert("Wrong admin credentials");
    }
  }

  function listUsers() {
    let html = "";
    for (let u in users) {
      let d = users[u];
      html += `<div class="card">
        <b>${u}</b><br/>
        Wallet: ${d.wallet}<br/>
        Deposit: $${d.deposit} | Income: $${d.income} | Ref: $${d.refIncome} | Withdrawn: $${d.withdrawn}<br/>
        Pending Deposit: $${d.pendingDeposit || 0}<br/>
        <button onclick="approveDeposit('${u}')">Approve Deposit</button>
        <button onclick="addIncome('${u}')">Add Weekly Income</button>
      </div>`;
    }
    userList.innerHTML = html;
  }

  function approveDeposit(u) {
    if (users[u].pendingDeposit) {
      users[u].deposit += users[u].pendingDeposit;
      if (users[users[u].refBy]) {
        users[users[u].refBy].refIncome += users[u].pendingDeposit * 0.05;
      }
      users[u].pendingDeposit = 0;
      users[u].active = true;
      saveUsers();
      alert("Deposit approved");
      listUsers();
    }
  }

  function addIncome(u) {
    if (!users[u].active) return alert("Deposit not approved yet");
    let base = users[u].deposit;
    let total = users[u].income + users[u].withdrawn;
    if (total >= base * 2) return alert("2X income already paid");
    users[u].income += base * 0.1; // Weekly 10%
    if (users[u].income + users[u].withdrawn > base * 2) {
      users[u].income = base * 2 - users[u].withdrawn;
    }
    saveUsers();
    alert("Weekly income added");
    listUsers();
  }
</script>
</body>
</html>
