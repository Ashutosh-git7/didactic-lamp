<!DOCTYPE html>
<html>
<head>
  <title>Ashirwad Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; margin: 10px; padding: 0; background: #f4f4f4; }
    .box { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
    input, button { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; }
    .hidden { display: none; }
    .title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
  </style>
</head>
<body>

<div id="registerBox" class="box">
  <div class="title">Register</div>
  <input id="regName" placeholder="Enter name">
  <input id="regPass" type="password" placeholder="Enter password">
  <button onclick="register()">Register</button>
  <p>Already registered? <a href="#" onclick="showLogin()">Login</a></p>
</div>

<div id="loginBox" class="box hidden">
  <div class="title">Login</div>
  <input id="logID" placeholder="Enter your User ID">
  <input id="logPass" type="password" placeholder="Enter password">
  <button onclick="login()">Login</button>
</div>

<div id="dashboard" class="box hidden">
  <div class="title">Welcome, <span id="dashName"></span>!</div>
  <p>Your ID: <b id="dashID"></b></p>
  <p>Total Approved Deposit: $<span id="totalDeposit">0</span></p>
  <p>Monthly Return (5%): $<span id="monthlyReturn">0</span></p>
  <p>Total Referral Commission (10%): $<span id="refBonus">0</span></p>
  <p><b>Your referral link:</b><br><span id="refLink"></span></p>
  <input id="depositAmt" placeholder="Enter deposit amount ($10â€“1000)">
  <button onclick="submitDeposit()">Deposit</button>
  <p>Send USDT to: <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
  <p><b>Status:</b> <span id="depositStatus">None</span></p>
  <button onclick="requestWithdrawal()">Request Withdrawal</button>
  <br><br><button onclick="logout()">Logout</button>
</div>

<div id="adminBox" class="box hidden">
  <div class="title">Admin Login</div>
  <input id="adminID" placeholder="Admin ID">
  <input id="adminPass" type="password" placeholder="Password">
  <button onclick="adminLogin()">Login</button>
</div>

<div id="adminPanel" class="box hidden">
  <div class="title">Admin Panel</div>
  <div id="allDeposits"></div>
  <button onclick="logout()">Logout</button>
</div>

<script>
  let users = JSON.parse(localStorage.getItem('users') || '{}');
  let deposits = JSON.parse(localStorage.getItem('deposits') || '[]');
  let currentUser = localStorage.getItem('currentUser');
  const ref = new URLSearchParams(window.location.search).get("ref");

  function save() {
    localStorage.setItem('users', JSON.stringify(users));
    localStorage.setItem('deposits', JSON.stringify(deposits));
  }

  function register() {
    const name = regName.value.trim();
    const pass = regPass.value.trim();
    if (!name || !pass) return alert("All fields required");
    const id = 'USR' + (1000 + Object.keys(users).length + 1);
    users[id] = { name, pass, deposit: 0, pending: 0, ref, refBonus: 0, withdraw: false };
    save();
    alert("Registered! Your ID: " + id);
    showLogin();
  }

  function showLogin() {
    registerBox.classList.add('hidden');
    loginBox.classList.remove('hidden');
  }

  function login() {
    const id = logID.value.trim();
    const pass = logPass.value.trim();
    if (users[id] && users[id].pass === pass) {
      currentUser = id;
      localStorage.setItem('currentUser', id);
      showDashboard();
    } else {
      alert("Invalid login");
    }
  }

  function showDashboard() {
    const u = users[currentUser];
    if (!u) return;
    dashName.innerText = u.name;
    dashID.innerText = currentUser;
    totalDeposit.innerText = u.deposit;
    monthlyReturn.innerText = (u.deposit * 0.05).toFixed(2);
    refBonus.innerText = u.refBonus || 0;
    refLink.innerText = window.location.origin + window.location.pathname + '?ref=' + currentUser;
    depositStatus.innerText = u.pending ? "Pending Approval: $" + u.pending : "Approved";
    registerBox.classList.add('hidden');
    loginBox.classList.add('hidden');
    dashboard.classList.remove('hidden');
    adminBox.classList.add('hidden');
    adminPanel.classList.add('hidden');
  }

  function submitDeposit() {
    const amt = parseFloat(depositAmt.value);
    if (isNaN(amt) || amt < 10 || amt > 1000) return alert("Amount must be $10-$1000");
    const u = users[currentUser];
    u.pending = amt;
    deposits.push({ id: currentUser, amount: amt, status: 'pending' });
    if (u.ref && users[u.ref]) {
      users[u.ref].refBonus = (users[u.ref].refBonus || 0) + (amt * 0.1);
    }
    save();
    alert("Deposit submitted! Wait for admin approval.");
    showDashboard();
  }

  function requestWithdrawal() {
    const u = users[currentUser];
    if (!u || u.deposit <= 0) return alert("No approved deposit.");
    alert("Withdrawal request sent to admin.");
    u.withdraw = true;
    save();
  }

  function logout() {
    currentUser = null;
    localStorage.removeItem('currentUser');
    location.reload();
  }

  function adminLogin() {
    const id = adminID.value.trim();
    const pass = adminPass.value.trim();
    if (id === 'admin' && pass === 'admin123') {
      showAdminPanel();
    } else {
      alert("Invalid admin login");
    }
  }

  function showAdminPanel() {
    let html = '';
    deposits.forEach((d, i) => {
      html += `<div>
        <b>${d.id}</b> - $${d.amount} - ${d.status}
        ${d.status === 'pending' ? `<button onclick="approve(${i})">Approve</button>` : ''}
      </div>`;
    });
    allDeposits.innerHTML = html || "No deposits yet.";
    adminBox.classList.add('hidden');
    adminPanel.classList.remove('hidden');
  }

  function approve(index) {
    const d = deposits[index];
    const u = users[d.id];
    if (u) {
      u.deposit += d.amount;
      u.pending = 0;
      deposits[index].status = 'approved';
      save();
      showAdminPanel();
    }
  }

  if (currentUser && users[currentUser]) {
    showDashboard();
  } else {
    registerBox.classList.remove('hidden');
  }
</script>
</body>
</html>
