<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ashirwad Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    input, button { width: 90%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { background-color: #28a745; color: white; font-weight: bold; }
    .section { margin-top: 20px; }
    .hidden { display: none; }
    small { font-size: 12px; color: gray; }
  </style>
</head>
<body>

<div class="container">
  <h2>üåü Ashirwad Investment</h2>

  <!-- Registration -->
  <div id="authSection">
    <input type="text" id="refInput" placeholder="Referral ID (optional)" />
    <button onclick="registerUser()">Register / Login</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">
    <p><b>Your ID:</b> <span id="userId"></span></p>
    <p><b>Deposit:</b> <span id="userDeposit">0</span> USDT</p>
    <p><b>Interest:</b> <span id="userInterest">0</span> USDT</p>
    <p><b>Referral:</b> <span id="userReferral">0</span> USDT</p>

    <div class="section">
      <h4>üí∏ Deposit</h4>
      <p>Send to: <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
      <input type="number" id="depositAmt" placeholder="Amount (1-1000)" />
      <button onclick="submitDeposit()">I have paid</button>
    </div>

    <div class="section">
      <h4>üîê Wallet Address</h4>
      <input type="text" id="walletAddr" placeholder="Your BEP20 Wallet" />
      <button onclick="saveWallet()">Save Wallet</button>
    </div>

    <div class="section">
      <h4>üí∞ Withdraw</h4>
      <button onclick="requestInterest()">Withdraw Interest</button>
      <button onclick="requestReferral()">Withdraw Referral</button>
      <button onclick="requestPrincipal()">Withdraw Deposit</button>
    </div>

    <div class="section">
      <h4>üë• Referral Link</h4>
      <p id="refLink"></p>
      <button onclick="viewReferrals()">View Team</button>
    </div>

    <button onclick="logout()">Logout</button>
  </div>

  <!-- Admin -->
  <div id="adminSection" class="section">
    <h3>üîê Admin Login</h3>
    <input type="text" id="adminUser" placeholder="Username" />
    <input type="password" id="adminPass" placeholder="Password" />
    <button onclick="adminLogin()">Login</button>

    <div id="adminPanel" class="hidden">
      <h4>‚úÖ Approve Deposits</h4>
      <ul id="depositList"></ul>

      <h4>üì§ Withdrawal Requests</h4>
      <ul id="withdrawList"></ul>
    </div>
  </div>

  <small>Made for Telegram Mini App ‚Äì Ashirwad Plan</small>
</div>

<script>
let users = JSON.parse(localStorage.getItem("ashirUsers") || "{}");
let withdrawals = JSON.parse(localStorage.getItem("ashirWithdrawals") || "[]");
let current = localStorage.getItem("ashirCurrent");

function saveData() {
  localStorage.setItem("ashirUsers", JSON.stringify(users));
  localStorage.setItem("ashirWithdrawals", JSON.stringify(withdrawals));
}

function registerUser() {
  const ref = document.getElementById("refInput").value.trim();
  const id = "ID" + Math.floor(10000 + Math.random() * 90000);
  users[id] = {
    deposit: 0, approved: false, interest: 0, wallet: "",
    refBy: ref, referrals: [], refAmt: 0, depDate: null
  };
  if (users[ref]) users[ref].referrals.push(id);
  current = id;
  localStorage.setItem("ashirCurrent", id);
  saveData();
  showDashboard();
}

function showDashboard() {
  document.getElementById("authSection").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");
  let u = users[current];
  document.getElementById("userId").innerText = current;
  document.getElementById("userDeposit").innerText = u.deposit;
  const days = getDaysSince(u.depDate);
  document.getElementById("userInterest").innerText =
    u.approved && days >= 30 ? (u.deposit * 0.05).toFixed(2) : "Pending";
  document.getElementById("userReferral").innerText = u.refAmt.toFixed(2);
  document.getElementById("refLink").innerText =
    location.href.split("?")[0] + "?ref=" + current.replace("ID", "");
}

function submitDeposit() {
  let amt = parseFloat(document.getElementById("depositAmt").value);
  if (amt >= 1 && amt <= 1000) {
    users[current].deposit = amt;
    users[current].approved = false;
    users[current].depDate = new Date().toISOString();
    saveData();
    alert("Deposit submitted. Awaiting admin approval.");
  } else {
    alert("Enter valid amount.");
  }
}

function saveWallet() {
  let addr = document.getElementById("walletAddr").value.trim();
  if (addr.length > 10) {
    users[current].wallet = addr;
    saveData();
    alert("Wallet saved.");
  } else {
    alert("Invalid wallet.");
  }
}

function getDaysSince(dateStr) {
  if (!dateStr) return 0;
  const dep = new Date(dateStr);
  const now = new Date();
  const diff = (now - dep) / (1000 * 60 * 60 * 24);
  return Math.floor(diff);
}

function requestInterest() {
  const u = users[current];
  if (!u.approved) return alert("Deposit not approved yet.");
  if (getDaysSince(u.depDate) < 30) return alert("Interest available after 30 days.");
  if (!withdrawals.includes(current + "_interest")) {
    withdrawals.push(current + "_interest");
    saveData();
    alert("Interest withdrawal requested.");
  } else {
    alert("Already requested.");
  }
}

function requestReferral() {
  if (!withdrawals.includes(current + "_ref")) {
    withdrawals.push(current + "_ref");
    saveData();
    alert("Referral withdrawal requested.");
  } else {
    alert("Already requested.");
  }
}

function requestPrincipal() {
  const u = users[current];
  if (getDaysSince(u.depDate) < 100) return alert("Deposit withdrawal only after 100 days.");
  if (!withdrawals.includes(current + "_principal")) {
    withdrawals.push(current + "_principal");
    saveData();
    alert("Deposit withdrawal requested.");
  } else {
    alert("Already requested.");
  }
}

function logout() {
  localStorage.removeItem("ashirCurrent");
  location.reload();
}

function viewReferrals() {
  alert("Your team: " + (users[current].referrals || []).join(", "));
}

function adminLogin() {
  let u = document.getElementById("adminUser").value;
  let p = document.getElementById("adminPass").value;
  if (u === "admin" && p === "admin123") {
    document.getElementById("adminPanel").classList.remove("hidden");
    showAdminData();
  } else {
    alert("Wrong credentials");
  }
}

function showAdminData() {
  const depList = document.getElementById("depositList");
  const wdList = document.getElementById("withdrawList");
  depList.innerHTML = "";
  wdList.innerHTML = "";

  for (let uid in users) {
    if (!users[uid].approved && users[uid].deposit > 0) {
      let li = document.createElement("li");
      li.innerHTML = uid + ": " + users[uid].deposit + " USDT " +
        `<button onclick="approveDeposit('${uid}')">Approve</button>`;
      depList.appendChild(li);
    }
  }

  withdrawals.forEach((wKey, i) => {
    const [uid, type] = wKey.split("_");
    let u = users[uid];
    let label = type === "interest" ? "Interest" : type === "ref" ? "Referral" : "Principal";
    if (u && u.wallet) {
      let li = document.createElement("li");
      li.innerHTML = `${uid} ‚Üí ${label} ‚Üí ${u.wallet} <button onclick="approveWithdraw(${i})">Approve</button>`;
      wdList.appendChild(li);
    }
  });
}

function approveDeposit(uid) {
  users[uid].approved = true;
  let ref = users[uid].refBy;
  if (users[ref]) users[ref].refAmt += users[uid].deposit * 0.10;
  saveData();
  showAdminData();
}

function approveWithdraw(i) {
  alert("Withdrawal approved: " + withdrawals[i]);
  withdrawals.splice(i, 1);
  saveData();
  showAdminData();
}

// Auto-login
(function(){
  const urlParams = new URLSearchParams(window.location.search);
  const ref = urlParams.get("ref");
  if (current) showDashboard();
  else if (ref) document.getElementById("refInput").value = "ID" + ref;
})();
</script>

</body>
</html>
