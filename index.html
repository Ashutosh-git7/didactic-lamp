<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ashirwad Mart App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    .container { max-width: 400px; margin: auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; }
    input, button, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; }
    .admin-panel, .user-dashboard { display: none; }
    .label { font-weight: bold; margin-top: 10px; }
    .section { margin-top: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    .note { font-size: 12px; color: #555; }
  </style>
</head>
<body>
  <div class="container" id="auth">
    <h2>Login / Register</h2>
    <input type="text" id="userId" placeholder="Enter User ID (for login)">
    <input type="password" id="password" placeholder="Enter Password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register New User</button>
  </div>

  <div class="container user-dashboard" id="userPanel">
    <h2>Welcome <span id="welcomeUser"></span></h2>
    <div class="section">
      <div class="label">Your Wallet Address</div>
      <input type="text" id="userWallet" placeholder="Enter BEP20 Wallet" disabled>
    </div>
    <div class="section">
      <div class="label">Deposit (50-500 USDT)</div>
      <div class="note">Send USDT to: <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></div>
      <input type="number" id="depositAmt" placeholder="Enter Deposit Amount">
      <button onclick="submitDeposit()">Submit Deposit</button>
    </div>
    <div class="section">
      <div class="label">Referral</div>
      <div>Your Referral Link:</div>
      <div id="refLink" style="font-size: 12px;"></div>
      <div>Referral Income: $<span id="refIncome">0</span></div>
    </div>
    <div class="section">
      <div class="label">Withdraw</div>
      <button onclick="requestWithdraw()">Withdraw Now</button>
      <div class="note">Minimum: 1 USDT</div>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="container admin-panel" id="adminPanel">
    <h2>Admin Panel</h2>
    <div class="section">
      <div class="label">Approve Deposits</div>
      <div id="pendingDeposits"></div>
    </div>
    <div class="section">
      <div class="label">Weekly Income Distribution</div>
      <button onclick="distributeWeekly()">Distribute Weekly Profit</button>
    </div>
    <div class="section">
      <div class="label">Edit User ID / Wallet</div>
      <input type="text" id="editUserId" placeholder="User ID">
      <input type="text" id="newWallet" placeholder="New Wallet">
      <button onclick="editWallet()">Update Wallet</button>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem("users") || "{}");
    let deposits = JSON.parse(localStorage.getItem("deposits") || "[]");
    let session = localStorage.getItem("session");

    function save() {
      localStorage.setItem("users", JSON.stringify(users));
      localStorage.setItem("deposits", JSON.stringify(deposits));
    }

    function register() {
      let id = "ASH" + Math.floor(Math.random() * 100000);
      let pass = document.getElementById("password").value.trim();
      if (!pass) return alert("Password required.");
      users[id] = { pass, wallet: "", ref: "", refIncome: 0, deposited: 0, earned: 0 };
      session = id;
      localStorage.setItem("session", id);
      save();
      alert("Registered with ID: " + id);
      showUserPanel();
    }

    function login() {
      let id = document.getElementById("userId").value.trim();
      let pass = document.getElementById("password").value.trim();
      if (id === "Admin" && pass === "Jaihanuman@7") {
        session = "Admin";
        localStorage.setItem("session", session);
        showAdminPanel();
      } else if (users[id] && users[id].pass === pass) {
        session = id;
        localStorage.setItem("session", session);
        showUserPanel();
      } else {
        alert("Invalid credentials.");
      }
    }

    function logout() {
      session = null;
      localStorage.removeItem("session");
      location.reload();
    }

    function showUserPanel() {
      document.getElementById("auth").style.display = "none";
      document.getElementById("userPanel").style.display = "block";
      document.getElementById("adminPanel").style.display = "none";
      document.getElementById("welcomeUser").innerText = session;
      document.getElementById("refLink").innerText = location.href.split("?")[0] + "?r=" + session;
      document.getElementById("refIncome").innerText = users[session].refIncome || 0;
      document.getElementById("userWallet").value = users[session].wallet || "";
    }

    function showAdminPanel() {
      document.getElementById("auth").style.display = "none";
      document.getElementById("userPanel").style.display = "none";
      document.getElementById("adminPanel").style.display = "block";
      let html = deposits.filter(d => !d.approved).map((d, i) => `
        <div>
          ${d.user} wants to deposit $${d.amount} 
          <button onclick="approveDeposit(${i})">Approve</button>
        </div>`).join("");
      document.getElementById("pendingDeposits").innerHTML = html || "No pending.";
    }

    function submitDeposit() {
      let amt = parseFloat(document.getElementById("depositAmt").value);
      if (amt < 50 || amt > 500) return alert("Deposit range is $50 to $500.");
      deposits.push({ user: session, amount: amt, approved: false, paid: 0 });
      save();
      alert("Deposit request submitted. Wait for admin approval.");
    }

    function approveDeposit(i) {
      deposits[i].approved = true;
      users[deposits[i].user].deposited += deposits[i].amount;
      let refId = users[deposits[i].user].ref;
      if (refId && users[refId]) {
        users[refId].refIncome += deposits[i].amount * 0.05;
      }
      save();
      showAdminPanel();
    }

    function requestWithdraw() {
      let user = users[session];
      if (user.refIncome >= 1) {
        alert("Withdraw successful: $" + user.refIncome.toFixed(2));
        user.refIncome = 0;
        save();
        showUserPanel();
      } else {
        alert("Minimum withdrawal is $1");
      }
    }

    function editWallet() {
      let id = document.getElementById("editUserId").value;
      let w = document.getElementById("newWallet").value;
      if (users[id]) {
        users[id].wallet = w;
        save();
        alert("Updated");
      } else alert("User not found");
    }

    function distributeWeekly() {
      deposits.forEach(d => {
        if (d.approved && d.paid < d.amount * 2) {
          let user = users[d.user];
          let pay = Math.min(d.amount * 0.1, d.amount * 2 - d.paid);
          d.paid += pay;
          user.refIncome += pay;
        }
      });
      save();
      alert("Weekly distribution done.");
    }

    // Auto-login if session exists
    if (session === "Admin") showAdminPanel();
    else if (session && users[session]) showUserPanel();

    // Referral on registration
    const url = new URL(location.href);
    const ref = url.searchParams.get("r");
    if (ref && !session) {
      document.getElementById("userId").placeholder = "Referred by: " + ref;
      register = (function(orig) {
        return function() {
          let id = "ASH" + Math.floor(Math.random() * 100000);
          let pass = document.getElementById("password").value.trim();
          if (!pass) return alert("Password required.");
          users[id] = { pass, wallet: "", ref, refIncome: 0, deposited: 0, earned: 0 };
          session = id;
          localStorage.setItem("session", id);
          save();
          alert("Registered with ID: " + id);
          showUserPanel();
        }
      })(register);
    }
  </script>
</body>
</html>
