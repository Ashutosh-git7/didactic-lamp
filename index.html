<!DOCTYPE html>
<html>
<head>
  <title>Ashirwad 2X App</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 0; padding: 0; }
    header { background: #4CAF50; color: white; text-align: center; padding: 15px; }
    section, .card { background: white; margin: 15px; padding: 15px; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1);}
    input, button, select { width: 100%; padding: 10px; margin: 8px 0; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
    button { background: #4CAF50; color: white; font-weight: bold; border: none; cursor: pointer; }
    .hide { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
    nav { background: #eee; text-align: center; padding: 10px; }
  </style>
</head>
<body>

<header>
  <h2>Ashirwad 2X Income App</h2>
</header>

<section id="loginSection">
  <h3>User Login / Register</h3>
  <input id="userId" placeholder="User ID (e.g. ANS123)" />
  <input id="wallet" placeholder="Your BEP20 Wallet Address" />
  <input id="refCode" placeholder="Referral Code (optional)" />
  <button onclick="loginUser()">Login / Register</button>
  <p id="loginMsg"></p>
</section>

<section id="userPanel" class="hide">
  <h3>Welcome, <span id="currentUser"></span></h3>
  <div class="card">
    <p><b>Wallet:</b> <span id="userWallet"></span></p>
    <p><b>Total Deposit:</b> <span id="userDeposit"></span> USDT</p>
    <p><b>Total Paid:</b> <span id="userPaid"></span> USDT</p>
    <p><b>Referral Bonus:</b> <span id="userReferral"></span> USDT</p>
    <p><b>Agreement:</b> <span id="userAgreement"></span></p>
  </div>

  <div class="card">
    <h4>Deposit (50–500 USDT)</h4>
    <p>Send to: <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
    <input id="depAmt" placeholder="Enter amount" />
    <button onclick="makeDeposit()">Submit Deposit</button>
  </div>

  <div class="card">
    <h4>Withdraw</h4>
    <button onclick="withdraw()">Withdraw Income/Referral</button>
  </div>

  <div class="card">
    <h4>Your Referral Link</h4>
    <input id="refLink" readonly />
  </div>
</section>

<section id="adminLoginSection">
  <h3>Admin Login</h3>
  <input id="adminId" placeholder="Admin ID" />
  <input id="adminPass" type="password" placeholder="Admin Password" />
  <button onclick="adminLogin()">Login</button>
</section>

<section id="adminPanel" class="hide">
  <h3>Admin Panel</h3>
  <div id="adminTableArea"></div>
</section>

<nav>
  &copy; 2025 Ashirwad Mart
</nav>

<script>
let db = JSON.parse(localStorage.getItem("ashirwadDB") || "{}");
let currentUser = "";

function saveDB() {
  localStorage.setItem("ashirwadDB", JSON.stringify(db));
}

function loginUser() {
  const id = document.getElementById("userId").value.trim().toUpperCase();
  const wallet = document.getElementById("wallet").value.trim();
  const ref = document.getElementById("refCode").value.trim().toUpperCase();

  if (!id.startsWith("ANS")) return alert("ID must start with ANS");
  if (!db[id]) {
    if (!wallet.startsWith("0x") || wallet.length < 20) return alert("Invalid wallet");
    db[id] = { wallet, deposit: 0, paid: 0, referral: 0, agreement: "open", ref: ref || "" };
    if (ref && db[ref]) db[ref].referral += 5;
  }

  currentUser = id;
  saveDB();
  showUserPanel();
}

function showUserPanel() {
  const u = db[currentUser];
  document.getElementById("loginSection").classList.add("hide");
  document.getElementById("userPanel").classList.remove("hide");
  document.getElementById("currentUser").innerText = currentUser;
  document.getElementById("userWallet").innerText = u.wallet;
  document.getElementById("userDeposit").innerText = u.deposit;
  document.getElementById("userPaid").innerText = u.paid;
  document.getElementById("userReferral").innerText = u.referral;
  document.getElementById("userAgreement").innerText = u.agreement;
  document.getElementById("refLink").value = location.href.split("?")[0] + "?r=" + currentUser.toLowerCase();
}

function makeDeposit() {
  const amt = parseFloat(document.getElementById("depAmt").value);
  if (amt < 50 || amt > 500) return alert("Deposit must be between 50–500");
  db[currentUser].deposit += amt;
  saveDB();
  alert("Deposit submitted.");
  showUserPanel();
}

function withdraw() {
  const user = db[currentUser];
  const total = user.referral + user.paid;
  if (total < 1) return alert("Minimum 1 USDT required.");
  alert("Withdrawal request sent.");
  user.referral = 0;
  saveDB();
  showUserPanel();
}

function adminLogin() {
  const id = document.getElementById("adminId").value;
  const pass = document.getElementById("adminPass").value;
  if (id === "Admin" && pass === "Jaihanuman@7") {
    document.getElementById("adminPanel").classList.remove("hide");
    document.getElementById("adminLoginSection").classList.add("hide");
    showAdminTable();
  } else {
    alert("Invalid admin login.");
  }
}

function showAdminTable() {
  let html = `<table><tr><th>ID</th><th>Wallet</th><th>Deposit</th><th>Paid</th><th>Referral</th><th>Agreement</th><th>Action</th></tr>`;
  for (let id in db) {
    let u = db[id];
    html += `<tr>
      <td>${id}</td>
      <td><input value="${u.wallet}" onchange="update('${id}','wallet',this.value)" /></td>
      <td><input value="${u.deposit}" onchange="update('${id}','deposit',this.value)" /></td>
      <td><input value="${u.paid}" onchange="update('${id}','paid',this.value)" /></td>
      <td><input value="${u.referral}" onchange="update('${id}','referral',this.value)" /></td>
      <td>
        <select onchange="update('${id}','agreement',this.value)">
          <option ${u.agreement==='open'?'selected':''}>open</option>
          <option ${u.agreement==='closed'?'selected':''}>closed</option>
        </select>
      </td>
      <td><button onclick="removeUser('${id}')">Delete</button></td>
    </tr>`;
  }
  html += `</table>`;
  document.getElementById("adminTableArea").innerHTML = html;
}

function update(id, field, value) {
  if (!db[id]) return;
  if (field === "deposit" || field === "paid" || field === "referral") {
    db[id][field] = parseFloat(value) || 0;
  } else {
    db[id][field] = value;
  }
  saveDB();
  showAdminTable();
}

function removeUser(id) {
  if (confirm("Delete user " + id + "?")) {
    delete db[id];
    saveDB();
    showAdminTable();
  }
}

window.onload = () => {
  const url = new URLSearchParams(window.location.search);
  const r = url.get("r");
  if (r) document.getElementById("refCode").value = r;
}
</script>

</body>
</html>
