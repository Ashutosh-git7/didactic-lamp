<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ashirwad Mart P - TMPL Staking Platform</title>
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
  header { background: #6a4baf; color:#fff; padding: 20px 10px; text-align:center; font-size:24px; }
  .container { max-width: 700px; margin:20px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
  label { display:block; margin-top:15px; font-weight:bold; }
  input, button { width: 100%; padding: 8px; margin-top:5px; }
  button { background-color:#6a4baf; color:white; border:none; cursor:pointer; font-size:16px; }
  button:hover { background-color:#533d8e; }
  .hidden { display:none; }
  .message { padding:10px; margin:10px 0; border-radius:5px; }
  .success { background: #d4edda; color:#155724; }
  .error { background: #f8d7da; color:#721c24; }
  nav { margin-bottom:20px; }
  nav button { width:auto; margin-right:10px; }
  .wallet-note { font-size: 12px; color: #555; margin-top: 5px; }
</style>
</head>
<body>
<header>Ashirwad Mart P - TMPL Staking</header>
<nav>
  <button onclick="showSection('register')">Register</button>
  <button onclick="showSection('login')">Login</button>
  <button onclick="showSection('dashboard')" id="dashBtn" class="hidden">Dashboard</button>
  <button onclick="logoutUser()" id="logoutBtn" class="hidden">Logout</button>
</nav>
<div class="container">

<!-- Registration Section -->
<section id="register">
  <h2>Register</h2>
  <form id="registerForm">
    <label for="name">Name</label>
    <input type="text" id="name" required />
    <label for="email">Email</label>
    <input type="email" id="email" required />
    <label for="password">Password</label>
    <input type="password" id="password" required minlength="6" />
    <label for="wallet">BEP-20 Wallet Address <span style="color: red;">*</span></label>
    <input type="text" id="wallet" placeholder="Enter your BEP-20 Wallet address" required />
    <small class="wallet-note">Your BEP-20 wallet address is mandatory for staking and withdrawals.</small>
    <label for="referral">Referral Code (Optional)</label>
    <input type="text" id="referral" placeholder="Referral code if any" />
    <button type="submit">Register</button>
  </form>
  <div id="registerMessage"></div>
</section>

<!-- Login Section -->
<section id="login" class="hidden">
  <h2>Login</h2>
  <form id="loginForm">
    <label for="loginEmail">Email</label>
    <input type="email" id="loginEmail" required />
    <label for="loginPassword">Password</label>
    <input type="password" id="loginPassword" required />
    <button type="submit">Login</button>
  </form>
  <div id="loginMessage"></div>
</section>

<!-- Dashboard Section -->
<section id="dashboard" class="hidden">
  <h2>Dashboard</h2>
  <div>
    <p><strong>Welcome, </strong><span id="userName"></span></p>
    <p><strong>Your BEP-20 Wallet:</strong> <span id="userWallet"></span></p>
    <p><strong>TMPL Balance:</strong> <span id="tmplBalance">0</span></p>
    <p><strong>Staked TMPL:</strong> <span id="stakedTmpl">0</span></p>
    <p><strong>Pending Rewards:</strong> <span id="pendingRewards">0</span></p>
  </div>

  <hr />

  <h3>Buy TMPL Tokens</h3>
  <form id="buyForm">
    <label for="buyAmount">Amount in USDT (Min 15, Max 600)</label>
    <input type="number" id="buyAmount" min="15" max="600" step="0.01" required />
    <p>Price per TMPL: 0.001 USDT</p>
    <button type="submit">Buy TMPL</button>
  </form>
  <div id="buyMessage"></div>

  <hr />

  <h3>Stake TMPL Tokens</h3>
  <form id="stakeForm">
    <label for="stakeAmount">Amount of TMPL to Stake</label>
    <input type="number" id="stakeAmount" min="15000" step="1" required />
    <p>Minimum stake: 15,000 TMPL (15 USDT equivalent)</p>
    <button type="submit">Stake TMPL</button>
  </form>
  <div id="stakeMessage"></div>

  <hr />

  <h3>Request Withdrawal</h3>
  <form id="withdrawForm">
    <label for="withdrawAmount">Amount of TMPL to Withdraw</label>
    <input type="number" id="withdrawAmount" min="1" step="1" required />
    <p>Note: Withdrawal requests need admin approval.</p>
    <button type="submit">Request Withdrawal</button>
  </form>
  <div id="withdrawMessage"></div>
</section>

</div>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  function showSection(name) {
    ['register','login','dashboard'].forEach(sec => {
      document.getElementById(sec).classList.add('hidden');
    });
    document.getElementById(name).classList.remove('hidden');
    if(name === 'dashboard') {
      document.getElementById('dashBtn').classList.remove('hidden');
      document.getElementById('logoutBtn').classList.remove('hidden');
    } else {
      document.getElementById('dashBtn').classList.add('hidden');
      document.getElementById('logoutBtn').classList.add('hidden');
    }
  }

  // Registration
  document.getElementById('registerForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const wallet = document.getElementById('wallet').value.trim();
    const referral = document.getElementById('referral').value.trim();

    if(wallet.length < 20) {
      showMessage('registerMessage', 'Invalid BEP-20 wallet address', 'error');
      return;
    }

    auth.createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        const userData = {
          uid: user.uid,
          name: name,
          email: email,
          wallet: wallet,
          referral: referral || null,
          tmplBalance: 0,
          stakedTmpl: 0,
          pendingRewards: 0,
          createdAt: new Date().toISOString(),
          stakingStart: null
        };
        db.ref('users/' + user.uid).set(userData).then(() => {
          showMessage('registerMessage', 'Registration successful! Please login.', 'success');
          document.getElementById('registerForm').reset();
          showSection('login');
        });
      })
      .catch((error) => {
        showMessage('registerMessage', error.message, 'error');
      });
  });

  // Login
  document.getElementById('loginForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;

    auth.signInWithEmailAndPassword(email, password)
      .then((userCredential) => {
        showMessage('loginMessage', 'Login successful!', 'success');
        loadUserDashboard(userCredential.user.uid);
        showSection('dashboard');
      })
      .catch((error) => {
        showMessage('loginMessage', error.message, 'error');
      });
  });

  function logoutUser() {
    auth.signOut().then(() => {
      showSection('login');
      clearDashboard();
    });
  }

  // Load user dashboard data
  function loadUserDashboard(uid) {
    db.ref('users/' + uid).once('value').then(snapshot => {
      const data = snapshot.val();
      if(data) {
        document.getElementById('userName').textContent = data.name;
        document.getElementById('userWallet').textContent = data.wallet;
        document.getElementById('tmplBalance').textContent = data.tmplBalance || 0;
        document.getElementById('stakedTmpl').textContent = data.stakedTmpl || 0;
        document.getElementById('pendingRewards').textContent = data.pendingRewards || 0;
      }
    });
  }

  function clearDashboard() {
    document.getElementById('userName').textContent = '';
    document.getElementById('userWallet').textContent = '';
    document.getElementById('tmplBalance').textContent = '0';
    document.getElementById('stakedTmpl').textContent = '0';
    document.getElementById('pendingRewards').textContent = '0';
  }

  // Buy TMPL
  document.getElementById('buyForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const buyAmountUSDT = parseFloat(document.getElementById('buyAmount').value);
    if(isNaN(buyAmountUSDT) || buyAmountUSDT < 15 || buyAmountUSDT > 600) {
      showMessage('buyMessage', 'Amount must be between 15 and 600 USDT', 'error');
      return;
    }
    const pricePerTMPL = 0.001;
    const boughtTMPL = buyAmountUSDT / pricePerTMPL;

    const user = auth.currentUser;
    if(!user) {
      showMessage('buyMessage', 'Please login to buy TMPL', 'error');
      return;
    }

    const userRef = db.ref('users/' + user.uid);

    userRef.once('value').then(snapshot => {
      const data = snapshot.val();
      if(data) {
        const newBalance = (data.tmplBalance || 0) + boughtTMPL;
        userRef.update({ tmplBalance: newBalance }).then(() => {
          // Record purchase
          const purchaseRef = db.ref('purchases/' + user.uid).push();
          purchaseRef.set({ usdtAmount: buyAmountUSDT, tmplAmount: boughtTMPL, time: new Date().toISOString() });
          showMessage('buyMessage', `Successfully purchased ${boughtTMPL.toFixed(2)} TMPL!`, 'success');
          document.getElementById('buyForm').reset();
          loadUserDashboard(user.uid);
        });
      }
    });
  });

  // Stake TMPL
  document.getElementById('stakeForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const stakeAmount = parseFloat(document.getElementById('stakeAmount').value);
    if(isNaN(stakeAmount) || stakeAmount < 15000) {
      showMessage('stakeMessage', 'Minimum stake is 15,000 TMPL', 'error');
      return;
    }

    const user = auth.currentUser;
    if(!user) {
      showMessage('stakeMessage', 'Please login to stake TMPL', 'error');
      return;
    }

    const userRef = db.ref('users/' + user.uid);

    userRef.once('value').then(snapshot => {
      const data = snapshot.val();
      if(data) {
        if((data.tmplBalance || 0) < stakeAmount) {
          showMessage('stakeMessage', 'Insufficient TMPL balance to stake', 'error');
          return;
        }

        const newBalance = data.tmplBalance - stakeAmount;
        const newStaked = (data.stakedTmpl || 0) + stakeAmount;
        let stakingStart = data.stakingStart;
        if(!stakingStart) {
          stakingStart = new Date().toISOString();
        }
        userRef.update({ tmplBalance: newBalance, stakedTmpl: newStaked, stakingStart: stakingStart }).then(() => {
          const stakeRef = db.ref('stakes/' + user.uid).push();
          stakeRef.set({ amount: stakeAmount, time: new Date().toISOString() });
          showMessage('stakeMessage', `Successfully staked ${stakeAmount} TMPL!`, 'success');
          document.getElementById('stakeForm').reset();
          loadUserDashboard(user.uid);
        });
      }
    });
  });

  // Withdraw Request
  document.getElementById('withdrawForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const withdrawAmount = parseFloat(document.getElementById('withdrawAmount').value);
    if(isNaN(withdrawAmount) || withdrawAmount < 1) {
      showMessage('withdrawMessage', 'Minimum withdrawal amount is 1 TMPL', 'error');
      return;
    }

    const user = auth.currentUser;
    if(!user) {
      showMessage('withdrawMessage', 'Please login to request withdrawal', 'error');
      return;
    }

    const withdrawalReqRef = db.ref('withdrawalRequests/' + user.uid).push();
    withdrawalReqRef.set({ amount: withdrawAmount, time: new Date().toISOString(), status: 'pending' })
      .then(() => {
        showMessage('withdrawMessage', 'Withdrawal request sent. Waiting for admin approval.', 'success');
        document.getElementById('withdrawForm').reset();
      });
  });

  function showMessage(id, message, type) {
    const div = document.getElementById(id);
    div.textContent = message;
    div.className = `message ${type}`;
    setTimeout(() => { div.textContent = ''; div.className = ''; }, 7000);
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      showSection('dashboard');
      loadUserDashboard(user.uid);
    } else {
      showSection('login');
      clearDashboard();
    }
  });
</script>
</body>
</html>
