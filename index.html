<!-- Full Ashirwad Mart Telegram Mini App Code -->
<!DOCTYPE html>
<html>
<head>
  <title>Ashirwad Mart</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f7f7f7; }
    .container { padding: 20px; }
    input, button, select { margin: 5px 0; padding: 10px; width: 100%; }
    .card { background: #fff; padding: 15px; margin-bottom: 15px; border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .admin-section { display: none; }
    .hidden { display: none; }
    .bold { font-weight: bold; }
  </style>
</head>
<body>
<div class="container">
  <div id="auth">
    <div class="card">
      <h2>Register</h2>
      <input id="regName" placeholder="Name" />
      <input id="regMobile" placeholder="Mobile" />
      <input id="regWallet" placeholder="USDT BEP20 Wallet" />
      <input id="regRef" placeholder="Referral Code (optional)" />
      <button onclick="register()">Register</button>
    </div>
    <div class="card">
      <h2>Login</h2>
      <input id="loginMobile" placeholder="Mobile" />
      <button onclick="login()">Login</button>
    </div>
    <div class="card">
      <h2>Admin Login</h2>
      <input id="adminId" placeholder="Admin ID" />
      <input id="adminPass" type="password" placeholder="Password" />
      <button onclick="adminLogin()">Login as Admin</button>
    </div>
  </div>

  <div id="userPanel" class="hidden">
    <div class="card">
      <h2>Welcome, <span id="userName"></span></h2>
      <p><span class="bold">Wallet:</span> <span id="userWallet"></span></p>
      <p><span class="bold">Referral Code:</span> <span id="userId"></span></p>
      <p><span class="bold">Total Deposit:</span> $<span id="totalDeposit"></span></p>
      <p><span class="bold">Income Wallet:</span> $<span id="incomeWallet"></span></p>
      <p><span class="bold">Referral Income:</span> $<span id="refIncome"></span></p>
      <p><span class="bold">Agreement:</span> <span id="agreementStatus"></span></p>
    </div>

    <div class="card">
      <h3>Deposit USDT</h3>
      <p>Send to: <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
      <input id="depositAmt" placeholder="Amount (50-500)" />
      <button onclick="submitDeposit()">Submit Deposit</button>
    </div>

    <div class="card">
      <h3>Request Withdrawal</h3>
      <input id="withdrawAmt" placeholder="Amount (min $1)" />
      <button onclick="requestWithdraw()">Request Withdraw</button>
    </div>

    <div class="card">
      <h3>Referral Team</h3>
      <ul id="teamList"></ul>
    </div>

    <div class="card">
      <h3>Deposit History</h3>
      <ul id="depositHistory"></ul>
    </div>

    <div class="card">
      <h3>Withdrawal History</h3>
      <ul id="withdrawalHistory"></ul>
    </div>

    <button onclick="logout()">Logout</button>
  </div>

  <div id="adminPanel" class="admin-section">
    <div class="card">
      <h2>Admin Panel</h2>
      <ul id="adminUserList"></ul>
      <button onclick="logout()">Logout</button>
    </div>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "ashirwadmart-6d657.firebaseapp.com",
    projectId: "ashirwadmart-6d657",
    storageBucket: "ashirwadmart-6d657.appspot.com",
    messagingSenderId: "YOUR_MESSAGING_ID",
    appId: "YOUR_APP_ID",
    databaseURL: "https://ashirwadmart-6d657-default-rtdb.firebaseio.com"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUserId = null;
  let isAdmin = false;

  function register() {
    const name = regName.value.trim();
    const mobile = regMobile.value.trim();
    const wallet = regWallet.value.trim();
    const ref = regRef.value.trim().toLowerCase();

    if (!name || !mobile || !wallet) return alert("All fields required");

    db.ref("users/" + mobile).once("value", snap => {
      if (snap.exists()) return alert("User exists");
      const userData = {
        name, wallet, ref, income: 0, refIncome: 0,
        deposit: 0, agreement: "active", deposits: [], withdrawals: [], team: []
      };
      db.ref("users/" + mobile).set(userData);
      if (ref) {
        db.ref("users/" + ref + "/team").once("value", s => {
          const team = s.val() || [];
          team.push(mobile);
          db.ref("users/" + ref + "/team").set(team);
        });
      }
      alert("Registered. Now login.");
    });
  }

  function login() {
    const mobile = loginMobile.value.trim();
    db.ref("users/" + mobile).once("value", snap => {
      if (!snap.exists()) return alert("User not found");
      currentUserId = mobile;
      isAdmin = false;
      showUserPanel(snap.val());
    });
  }

  function adminLogin() {
    const id = adminId.value;
    const pass = adminPass.value;
    if (id === "Admin" && pass === "Jaihanuman@7") {
      isAdmin = true;
      currentUserId = "admin";
      showAdminPanel();
    } else alert("Wrong credentials");
  }

  function logout() {
    location.reload();
  }

  function showUserPanel(data) {
    document.getElementById("auth").classList.add("hidden");
    userPanel.classList.remove("hidden");
    userName.innerText = data.name;
    userWallet.innerText = data.wallet;
    userId.innerText = currentUserId;
    totalDeposit.innerText = data.deposit || 0;
    incomeWallet.innerText = data.income || 0;
    refIncome.innerText = data.refIncome || 0;
    agreementStatus.innerText = data.agreement;

    teamList.innerHTML = (data.team || []).map(t => `<li>${t}</li>`).join("");
    depositHistory.innerHTML = (data.deposits || []).map(d => `<li>${d.amount} - ${d.status}</li>`).join("");
    withdrawalHistory.innerHTML = (data.withdrawals || []).map(w => `<li>${w.amount} - ${w.status}</li>`).join("");
  }

  function submitDeposit() {
    const amt = parseFloat(depositAmt.value);
    if (amt < 50 || amt > 500) return alert("Amount between $50 and $500");

    db.ref("users/" + currentUserId).once("value", snap => {
      const user = snap.val();
      const deposits = user.deposits || [];
      deposits.push({ amount: amt, status: "pending" });
      db.ref("users/" + currentUserId + "/deposits").set(deposits);
      alert("Deposit submitted. Wait for approval.");
    });
  }

  function requestWithdraw() {
    const amt = parseFloat(withdrawAmt.value);
    if (amt < 1) return alert("Minimum $1");

    db.ref("users/" + currentUserId).once("value", snap => {
      const user = snap.val();
      if (amt > user.income) return alert("Insufficient income");

      const withdrawals = user.withdrawals || [];
      withdrawals.push({ amount: amt, status: "pending" });
      db.ref("users/" + currentUserId + "/withdrawals").set(withdrawals);
      db.ref("users/" + currentUserId + "/income").set(user.income - amt);
      alert("Withdrawal requested.");
    });
  }

  function showAdminPanel() {
    document.getElementById("auth").classList.add("hidden");
    document.getElementById("adminPanel").style.display = "block";

    db.ref("users").once("value", snap => {
      const users = snap.val();
      let html = "";
      Object.keys(users).forEach(uid => {
        const u = users[uid];
        html += `<li>
          <b>${u.name}</b> (${uid})<br>
          Wallet: ${u.wallet}<br>
          Deposit: $${u.deposit || 0}, Income: $${u.income || 0}, Ref: $${u.refIncome || 0}<br>
          <button onclick="approveDeposit('${uid}')">Approve Deposit</button>
          <button onclick="approveWithdraw('${uid}')">Approve Withdraw</button>
          <button onclick="addWeekly('${uid}')">Add Weekly Income</button>
          <button onclick="closeAgreement('${uid}')">Close Agreement</button><hr>
        </li>`;
      });
      adminUserList.innerHTML = html;
    });
  }

  function approveDeposit(uid) {
    db.ref("users/" + uid).once("value", snap => {
      const user = snap.val();
      let deposits = user.deposits || [];
      let latest = deposits[deposits.length - 1];
      if (latest && latest.status === "pending") {
        latest.status = "approved";
        db.ref("users/" + uid + "/deposits").set(deposits);
        db.ref("users/" + uid + "/deposit").set((user.deposit || 0) + latest.amount);
        if (user.ref) {
          db.ref("users/" + user.ref).once("value", rsnap => {
            let ruser = rsnap.val();
            let refAmt = latest.amount * 0.05;
            db.ref("users/" + user.ref + "/income").set((ruser.income || 0) + refAmt);
          });
        }
      }
      showAdminPanel();
    });
  }

  function approveWithdraw(uid) {
    db.ref("users/" + uid).once("value", snap => {
      const user = snap.val();
      let withdrawals = user.withdrawals || [];
      let latest = withdrawals[withdrawals.length - 1];
      if (latest && latest.status === "pending") {
        latest.status = "approved";
        db.ref("users/" + uid + "/withdrawals").set(withdrawals);
        if (user.agreement === "closed") db.ref("users/" + uid + "/income").set(0);
      }
      showAdminPanel();
    });
  }

  function addWeekly(uid) {
    db.ref("users/" + uid).once("value", snap => {
      const user = snap.val();
      let total = user.deposit * 2;
      let combined = (user.income || 0) + (user.refIncome || 0);
      if (combined < total && user.agreement !== "closed") {
        db.ref("users/" + uid + "/income").set((user.income || 0) + (user.deposit * 0.1));
      }
      showAdminPanel();
    });
  }

  function closeAgreement(uid) {
    db.ref("users/" + uid + "/agreement").set("closed");
    showAdminPanel();
  }
</script>
</body>
  </html>
