<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ashirwad Mart P - MLM Dashboard (Firebase)</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <style>
        body {font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9;}
        h1,h2 {color: #333;}
        table {width: 100%; border-collapse: collapse; margin-top: 15px;}
        th, td {padding: 8px 12px; border: 1px solid #ccc; text-align: center;}
        th {background-color: #4CAF50; color: white;}
        .form-section {margin-top: 20px; padding: 15px; background: #fff; border-radius: 5px; box-shadow: 0 0 5px #ccc;}
        input[type="text"], input[type="password"], input[type="number"], input[type="file"] {
            width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;
        }
        button {padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;}
        button:hover {background-color: #45a049;}
        button:disabled {background-color: #ccc; cursor: not-allowed;}
        .status {padding: 10px; margin-top: 10px; border-radius: 4px;}
        .success {background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;}
        .error {background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;}
        .loading {background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb;}
        .user-info {background: #e7f3ff; padding: 15px; margin-bottom: 20px; border-radius: 5px;}
    </style>
</head>
<body>

    <h1>üåü Ashirwad Mart P - MLM Dashboard</h1>
    
    <!-- User Info Display -->
    <div id="userInfo" class="user-info" style="display: none;">
        <h3>‡§Ü‡§™‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</h3>
        <div id="userDetails"></div>
    </div>

    <!-- KYC Registration -->
    <div class="form-section kyc-section">
        <h2>üîê KYC Registration</h2>
        <form id="kycForm">
            <label>‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ:</label>
            <input type="text" id="name" required />
            <label>‡§à‡§Æ‡•á‡§≤:</label>
            <input type="text" id="email" required />
            <label>‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞:</label>
            <input type="text" id="mobile" required />
            <label>‡§™‡•à‡§® ‡§®‡§Ç‡§¨‡§∞:</label>
            <input type="text" id="pan" required />
            <label>ID ‡§™‡•ç‡§∞‡•Ç‡§´ (‡§´‡§æ‡§á‡§≤):</label>
            <input type="file" id="idProof" accept="image/*,.pdf" />
            <button type="submit" id="kycBtn">KYC ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
        </form>
        <div id="kycStatus"></div>
    </div>

    <!-- MLM Business BV Display -->
    <div class="form-section">
        <h2>üìä 6 Level MLM Distribution (60% BV)</h2>
        <table>
            <thead>
                <tr>
                    <th>Level</th>
                    <th>% Share</th>
                    <th>Total BV (‚Çπ)</th>
                    <th>Your Commission (‚Çπ)</th>
                </tr>
            </thead>
            <tbody id="mlmTableBody">
            </tbody>
            <tfoot>
                <tr style="font-weight:bold; background: #f0f8ff;">
                    <td colspan="2">‡§ï‡•Å‡§≤ (60% Distribution)</td>
                    <td id="totalBV">0</td>
                    <td id="totalCommission">0</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <!-- Team Levels -->
    <div class="form-section">
        <h2>üë• Team Level Wise</h2>
        <table>
            <thead>
                <tr><th>Member</th><th>Level</th><th>BV (‚Çπ)</th><th>Status</th></tr>
            </thead>
            <tbody id="teamLevelBody"></tbody>
        </table>
    </div>

    <!-- Wallet & Withdrawal -->
    <div class="form-section withdraw-section">
        <h2>üí∞ Wallet & Withdrawal</h2>
        <div style="background: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
            <strong>Available Balance: <span id="walletBalance">‚Çπ0</span></strong>
        </div>
        <form id="withdrawForm">
            <label>Withdrawal Amount (Min ‚Çπ200):</label>
            <input type="number" id="withdrawAmount" min="200" required />
            <label>UPI ID:</label>
            <input type="text" id="upiId" placeholder="yourname@paytm" required />
            <button type="submit" id="withdrawBtn">Withdrawal Request ‡§≠‡•á‡§ú‡•á‡§Ç</button>
        </form>
        <div id="withdrawStatus"></div>
    </div>

    <!-- Password Change -->
    <div class="form-section password-section">
        <h2>üîë Password Change</h2>
        <form id="passwordChangeForm">
            <label>‡§™‡•Å‡§∞‡§æ‡§®‡§æ Password:</label>
            <input type="password" id="oldPassword" required />
            <label>‡§®‡§Ø‡§æ Password:</label>
            <input type="password" id="newPassword" required />
            <label>Confirm New Password:</label>
            <input type="password" id="confirmPassword" required />
            <button type="submit">Password Update ‡§ï‡§∞‡•á‡§Ç</button>
        </form>
        <div id="passwordStatus"></div>
    </div>

<script>
    // üî• YOUR FIREBASE CONFIG - Replace with your project config
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "123456789",
        appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Current user ID (generate or use mobile/email based)
    const userId = 'USER_' + Date.now(); // Replace with actual user ID logic
    const userRef = db.ref('users/' + userId);
    const teamRef = db.ref('team');
    const withdrawalsRef = db.ref('withdrawals');

    // MLM Commission structure - 60% total distribution
    const commissionPercentages = [20, 15, 10, 8, 5, 2]; // Total = 60%

    // Initialize user data on load
    window.onload = function() {
        loadUserData();
        loadTeamData();
        loadWalletData();
        populateMLMTable();
    };

    // Load user data from Firebase
    function loadUserData() {
        userRef.once('value').then(snapshot => {
            const userData = snapshot.val();
            if (userData) {
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('userDetails').innerHTML = `
                    <p><strong>Name:</strong> ${userData.name || 'N/A'}</p>
                    <p><strong>Mobile:</strong> ${userData.mobile || 'N/A'}</p>
                    <p><strong>KYC Status:</strong> <span style="color: ${userData.kycVerified ? '#28a745' : '#dc3545'}">
                        ${userData.kycVerified ? '‚úÖ Verified' : '‚è≥ Pending'}</span></p>
                `;
            }
        });
    }

    // KYC Registration
    document.getElementById('kycForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const statusDiv = document.getElementById('kycStatus');
        const btn = document.getElementById('kycBtn');
        
        btn.disabled = true;
        statusDiv.className = 'status loading';
        statusDiv.textContent = 'KYC submitting...';

        const kycData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            mobile: document.getElementById('mobile').value,
            pan: document.getElementById('pan').value,
            kycStatus: 'pending',
            kycVerified: false,
            timestamp: Date.now()
        };

        userRef.set(kycData).then(() => {
            statusDiv.className = 'status success';
            statusDiv.innerHTML = '‚úÖ KYC successfully submitted! Admin verification pending.';
            loadUserData();
        }).catch(error => {
            statusDiv.className = 'status error';
            statusDiv.textContent = '‚ùå Error: ' + error.message;
        }).finally(() => {
            btn.disabled = false;
        });
    });

    // Populate MLM Table
    function populateMLMTable() {
        const tbody = document.getElementById('mlmTableBody');
        let totalCommission = 0;
        const totalBV = 50000; // Dynamic from Firebase in real app

        tbody.innerHTML = '';
        commissionPercentages.forEach((percent, index) => {
            const commission = (totalBV * percent) / 100;
            totalCommission += commission;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>Level ${index + 1}</td>
                <td>${percent}%</td>
                <td>‚Çπ${totalBV.toLocaleString()}</td>
                <td>‚Çπ${commission.toLocaleString()}</td>
            `;
            tbody.appendChild(row);
        });

        document.getElementById('totalBV').textContent = '‚Çπ' + totalBV.toLocaleString();
        document.getElementById('totalCommission').textContent = '‚Çπ' + totalCommission.toLocaleString();
    }

    // Load Team Data
    function loadTeamData() {
        teamRef.on('value', snapshot => {
            const tbody = document.getElementById('teamLevelBody');
            tbody.innerHTML = '';
            snapshot.forEach(child => {
                const data = child.val();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.name}</td>
                    <td>Level ${data.level}</td>
                    <td>‚Çπ${data.bv?.toLocaleString() || 0}</td>
                    <td>${data.kycVerified ? '‚úÖ Verified' : '‚è≥ Pending'}</td>
                `;
                tbody.appendChild(row);
            });
        });
    }

    // Load Wallet Balance
    function loadWalletData() {
        userRef.child('wallet').on('value', snapshot => {
            const balance = snapshot.val() || 0;
            document.getElementById('walletBalance').textContent = '‚Çπ' + balance.toLocaleString();
        });
    }

    // Withdrawal Request
    document.getElementById('withdrawForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const amount = parseFloat(document.getElementById('withdrawAmount').value);
        if (amount < 200) {
            showStatus('withdrawStatus', 'Minimum ‚Çπ200 required!', 'error');
            return;
        }

        const withdrawalData = {
            userId: userId,
            amount: amount,
            upiId: document.getElementById('upiId').value,
            status: 'pending',
            timestamp: Date.now()
        };

        withdrawalsRef.push(withdrawalData).then(() => {
            showStatus('withdrawStatus', '‚úÖ Withdrawal request sent! Admin approval pending.', 'success');
        }).catch(error => {
            showStatus('withdrawStatus', '‚ùå Error: ' + error.message, 'error');
        });
    });

    // Password Change
    document.getElementById('passwordChangeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const newPass = document.getElementById('newPassword').value;
        const confirmPass = document.getElementById('confirmPassword').value;
        
        if (newPass !== confirmPass) {
            showStatus('passwordStatus', 'Passwords do not match!', 'error');
            return;
        }

        userRef.child('password').set(newPass).then(() => {
            showStatus('passwordStatus', '‚úÖ Password updated successfully!', 'success');
            this.reset();
        }).catch(error => {
            showStatus('passwordStatus', '‚ùå Error: ' + error.message, 'error');
        });
    });

    // Utility function
    function showStatus(elementId, message, type) {
        const element = document.getElementById(elementId);
        element.className = 'status ' + type;
        element.textContent = message;
    }
</script>

</body>
</html>
