<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ashirwad Signature App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background: #f4f6f8; padding: 10px; margin: 0; text-align: center; }
    input, button { margin: 5px 0; padding: 10px; width: 90%; max-width: 300px; }
    .section { display: none; background: white; padding: 20px; margin: 10px auto; max-width: 400px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    .visible { display: block; }
    .btn { background: #007bff; color: white; border: none; border-radius: 5px; }
    code { display: block; margin: 10px 0; background: #eee; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>

<h2>Ashirwad App</h2>

<!-- Register -->
<div id="register" class="section visible">
  <h3>Register</h3>
  <input type="text" id="regName" placeholder="Your Name"><br>
  <input type="text" id="regWallet" placeholder="Your USDT BEP20 Wallet"><br>
  <button class="btn" onclick="register()">Register</button>
  <p>Have ID? <a href="#" onclick="show('login')">Login</a></p>
</div>

<!-- Login -->
<div id="login" class="section">
  <h3>Login</h3>
  <input type="text" id="loginId" placeholder="Enter Ashirwad ID"><br>
  <button class="btn" onclick="login()">Login</button>
  <p>No ID? <a href="#" onclick="show('register')">Register</a></p>
</div>

<!-- Dashboard -->
<div id="dashboard" class="section">
  <h3>Welcome, <span id="name"></span></h3>
  <p><b>ID:</b> <span id="uid"></span><br>
     <b>Wallet:</b> <span id="wallet"></span><br>
     <b>Your Referral Link:</b><br><code id="refLink"></code></p>

  <h4>Deposit</h4>
  <p>Send USDT to:</p>
  <code>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</code>
  <input type="number" id="depositAmt" placeholder="Enter amount (10-1000)">
  <button class="btn" onclick="deposit()">Submit</button>

  <h4>Your Deposits</h4>
  <div id="deposits"></div>

  <h4>Withdraw</h4>
  <button class="btn" onclick="withdraw('interest')">Withdraw Interest</button>
  <button class="btn" onclick="withdraw('referral')">Withdraw Referral</button>

  <br><br><button onclick="logout()" class="btn" style="background:red;">Logout</button>
</div>

<!-- Admin -->
<div id="adminLogin" class="section">
  <h3>Admin Login</h3>
  <input type="text" id="adminId" placeholder="Admin ID"><br>
  <input type="password" id="adminPass" placeholder="Password"><br>
  <button class="btn" onclick="adminLogin()">Login</button>
</div>

<div id="adminPanel" class="section">
  <h3>Admin Panel</h3>
  <div id="adminUsers"></div>
  <button onclick="logout()" class="btn" style="background:red;">Logout</button>
</div>

<script>
let currentUser = null;

function show(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('visible'));
  document.getElementById(id).classList.add('visible');
}

function generateId() {
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const last = users.length ? parseInt(users[users.length-1].id.replace('Ashirwad','')) : 0;
  return 'Ashirwad' + String(last + 1).padStart(3, '0');
}

function register() {
  const name = document.getElementById('regName').value.trim();
  const wallet = document.getElementById('regWallet').value.trim();
  if (!name || !wallet) return alert("All fields required");

  const id = generateId();
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const ref = new URLSearchParams(location.search).get('r');
  users.push({ id, name, wallet, deposits: [], interest: 0, referral: 0, referredBy: ref || '' });
  localStorage.setItem('users', JSON.stringify(users));
  alert("Registered! Your ID: " + id);
  show('login');
}

function login() {
  const id = document.getElementById('loginId').value.trim();
  if (id === 'admin') return show('adminLogin');
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  const u = users.find(x => x.id.toLowerCase() === id.toLowerCase());
  if (!u) return alert("User not found");
  currentUser = u;
  updateUI();
  show('dashboard');
}

function updateUI() {
  document.getElementById('name').innerText = currentUser.name;
  document.getElementById('uid').innerText = currentUser.id;
  document.getElementById('wallet').innerText = currentUser.wallet;
  document.getElementById('refLink').innerText = location.origin + location.pathname + "?r=" + currentUser.id.toLowerCase();
  updateDeposits();
}

function deposit() {
  const amt = parseFloat(document.getElementById('depositAmt').value);
  if (isNaN(amt) || amt < 10 || amt > 1000) return alert("Enter valid amount");
  const users = JSON.parse(localStorage.getItem('users'));
  const u = users.find(u => u.id === currentUser.id);
  u.deposits.push({ amt, date: Date.now(), approved: false, interestDone: false, withdrawn: false });

  if (u.referredBy) {
    const refU = users.find(x => x.id.toLowerCase() === u.referredBy.toLowerCase());
    if (refU) refU.referral += amt * 0.10;
  }

  localStorage.setItem('users', JSON.stringify(users));
  currentUser = u;
  updateUI();
}

function updateDeposits() {
  const d = currentUser.deposits || [];
  let html = '';
  d.forEach((x, i) => {
    const days = Math.floor((Date.now() - x.date)/86400000);
    html += `Deposit ${i+1}: $${x.amt} | ${days} days | Approved: ${x.approved ? '✅' : '⏳'}<br>`;
    if (x.approved && days >= 30 && !x.interestDone)
      html += `<button onclick="markInterest(${i})">Withdraw 5% Interest</button><br>`;
    if (x.approved && days >= 100 && !x.withdrawn)
      html += `<button onclick="markWithdraw(${i})">Withdraw Principal</button><br>`;
    html += "<hr>";
  });
  document.getElementById('deposits').innerHTML = html || "No deposits yet.";
}

function markInterest(i) {
  const users = JSON.parse(localStorage.getItem('users'));
  const u = users.find(u => u.id === currentUser.id);
  const dep = u.deposits[i];
  const days = Math.floor((Date.now() - dep.date)/86400000);
  if (dep.approved && days >= 30 && !dep.interestDone) {
    u.interest += dep.amt * 0.05;
    dep.interestDone = true;
    localStorage.setItem('users', JSON.stringify(users));
    currentUser = u;
    updateUI();
  }
}

function markWithdraw(i) {
  const users = JSON.parse(localStorage.getItem('users'));
  const u = users.find(u => u.id === currentUser.id);
  const dep = u.deposits[i];
  const days = Math.floor((Date.now() - dep.date)/86400000);
  if (dep.approved && days >= 100 && !dep.withdrawn) {
    dep.withdrawn = true;
    localStorage.setItem('users', JSON.stringify(users));
    currentUser = u;
    updateUI();
  }
}

function withdraw(type) {
  const users = JSON.parse(localStorage.getItem('users'));
  const u = users.find(u => u.id === currentUser.id);
  if (type === 'interest') {
    alert("Interest: $" + u.interest.toFixed(2) + " sent to wallet!");
    u.interest = 0;
  } else {
    alert("Referral: $" + u.referral.toFixed(2) + " sent to wallet!");
    u.referral = 0;
  }
  localStorage.setItem('users', JSON.stringify(users));
  currentUser = u;
  updateUI();
}

function logout() {
  currentUser = null;
  show('login');
}

function adminLogin() {
  if (document.getElementById('adminId').value === 'admin' && document.getElementById('adminPass').value === 'admin123') {
    show('adminPanel');
    loadAdmin();
  } else alert("Wrong credentials");
}

function loadAdmin() {
  const users = JSON.parse(localStorage.getItem('users') || '[]');
  let html = '';
  users.forEach((u, i) => {
    html += `<b>${u.id}</b> (${u.name})<br>Wallet: ${u.wallet}<br>Referral: ${u.referredBy}<br>Interest: $${u.interest.toFixed(2)}, Referral: $${u.referral.toFixed(2)}<br>`;
    u.deposits.forEach((d,j) => {
      html += `#${j+1} $${d.amt} | ${Math.floor((Date.now()-d.date)/86400000)}d | Approved: ${d.approved ? '✅' : '❌'}`;
      if (!d.approved) html += ` <button onclick="approve(${i},${j})">Approve</button>`;
      html += '<br>';
    });
    html += "<hr>";
  });
  document.getElementById('adminUsers').innerHTML = html;
}

function approve(ui, di) {
  const users = JSON.parse(localStorage.getItem('users'));
  users[ui].deposits[di].approved = true;
  localStorage.setItem('users', JSON.stringify(users));
  loadAdmin();
}
</script>
</body>
</html>
