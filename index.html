<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ashirwad Mini App</title>
  <style>
    body { font-family:sans-serif; padding:15px; background:#f5f5f5; }
    h2 { color:#444; }
    input, button { padding:8px; margin:5px; width:90%; max-width:300px; }
    .box { background:#fff; padding:15px; margin:10px auto; max-width:400px; border-radius:10px; box-shadow:0 0 5px #ccc; }
    .hidden { display:none; }
    .btn-sm { padding:5px 10px; font-size:12px; margin:2px; }
    table { width:100%; font-size:14px; }
    td { padding:3px; }
  </style>
</head>
<body>

<div id="app">
  <div id="authBox" class="box">
    <h2>ğŸ” Login / Register</h2>
    <input type="text" id="name" placeholder="Enter Your Name" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="register()">Register</button>
    <button onclick="login()">Login</button>
    <p id="refInfo"></p>
  </div>

  <div id="dashboard" class="box hidden">
    <h2>ğŸ‘‹ Welcome, <span id="userName"></span></h2>
    <p><b>User ID:</b> <span id="userId"></span></p>
    <p><b>Referral Link:</b> <span id="refLink"></span></p>
    <p><b>Total Deposit:</b> $<span id="totalDeposit">0</span></p>
    <p><b>Pending Deposits:</b> <span id="pendingCount">0</span></p>
    <p><b>Referral Income:</b> $<span id="refIncome">0</span></p>
    <p><b>Wallet Address:</b></p>
    <input type="text" id="wallet" placeholder="Enter your BEP20 address" />
    <button onclick="saveWallet()">Save Wallet</button>

    <h3>ğŸ’° Make a Deposit</h3>
    <p>Send USDT to: <b>0x49F7A836A32C1aCF04d4d20Fa87A14C7a19aB74B</b></p>
    <input type="number" id="depositAmount" placeholder="Amount ($10 - $1000)" />
    <button onclick="makeDeposit()">Submit Deposit</button>

    <h3>ğŸ“¤ Withdraw</h3>
    <button onclick="requestWithdrawal()">Request Withdrawal</button>

    <button onclick="logout()">Logout</button>
  </div>

  <div id="adminLogin" class="box">
    <h2>ğŸ›  Admin Login</h2>
    <input type="text" id="adminId" placeholder="Admin ID" />
    <input type="password" id="adminPass" placeholder="Password" />
    <button onclick="adminLogin()">Login</button>
  </div>

  <div id="adminPanel" class="box hidden">
    <h2>ğŸ“‹ Admin Panel</h2>
    <button onclick="logoutAdmin()">Logout Admin</button>
    <h3>Pending Deposits</h3>
    <div id="pendingDeposits"></div>

    <h3>Withdraw Requests</h3>
    <div id="withdrawRequests"></div>

    <h3>All Users</h3>
    <div id="userList"></div>
  </div>
</div>

<script>
let users = JSON.parse(localStorage.getItem("users") || "[]");
let deposits = JSON.parse(localStorage.getItem("deposits") || "[]");
let withdrawals = JSON.parse(localStorage.getItem("withdrawals") || "[]");
let currentUser = JSON.parse(localStorage.getItem("currentUser") || "null");

function saveAll() {
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("deposits", JSON.stringify(deposits));
  localStorage.setItem("withdrawals", JSON.stringify(withdrawals));
}

function generateId() {
  let lastId = localStorage.getItem("lastId") || 1000;
  lastId++;
  localStorage.setItem("lastId", lastId);
  return "USR" + lastId;
}

function register() {
  let name = document.getElementById("name").value.trim();
  let password = document.getElementById("password").value;
  if (!name || !password) return alert("Enter all fields");

  let id = generateId();
  let ref = new URLSearchParams(window.location.search).get("ref") || "";
  let user = { id, name, password, ref, wallet: "", deposits: [], refIncome: 0 };
  users.push(user);
  currentUser = user;
  saveAll();
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  showDashboard();
}

function login() {
  let name = document.getElementById("name").value.trim();
  let password = document.getElementById("password").value;
  let user = users.find(u => u.name === name && u.password === password);
  if (!user) return alert("Invalid credentials");
  currentUser = user;
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  showDashboard();
}

function showDashboard() {
  document.getElementById("authBox").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");
  document.getElementById("userName").innerText = currentUser.name;
  document.getElementById("userId").innerText = currentUser.id;
  document.getElementById("refLink").innerText = location.origin + location.pathname + "?ref=" + currentUser.id;
  document.getElementById("wallet").value = currentUser.wallet || "";
  updateStats();
}

function updateStats() {
  let userDeposits = deposits.filter(d => d.userId === currentUser.id && d.status === "approved");
  let total = userDeposits.reduce((a,b)=>a+b.amount,0);
  document.getElementById("totalDeposit").innerText = total.toFixed(2);
  let pend = deposits.filter(d => d.userId === currentUser.id && d.status === "pending").length;
  document.getElementById("pendingCount").innerText = pend;
  document.getElementById("refIncome").innerText = currentUser.refIncome.toFixed(2);
}

function saveWallet() {
  let w = document.getElementById("wallet").value.trim();
  currentUser.wallet = w;
  users = users.map(u => u.id === currentUser.id ? currentUser : u);
  saveAll();
  alert("Wallet saved");
}

function makeDeposit() {
  let amt = parseFloat(document.getElementById("depositAmount").value);
  if (isNaN(amt) || amt < 10 || amt > 1000) return alert("Enter valid amount");
  deposits.push({ userId: currentUser.id, amount: amt, status: "pending" });
  saveAll();
  updateStats();
  alert("Deposit request submitted. Wait for admin approval.");
}

function requestWithdrawal() {
  withdrawals.push({ userId: currentUser.id, status: "pending" });
  saveAll();
  alert("Withdrawal requested");
}

function logout() {
  localStorage.removeItem("currentUser");
  location.reload();
}

function adminLogin() {
  let id = document.getElementById("adminId").value;
  let pass = document.getElementById("adminPass").value;
  if (id === "admin" && pass === "admin123") {
    document.getElementById("adminLogin").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
    loadAdmin();
  } else {
    alert("Wrong admin credentials");
  }
}

function logoutAdmin() {
  location.reload();
}

function loadAdmin() {
  let pd = deposits.filter(d => d.status === "pending");
  let html = pd.map((d,i)=>`<div>
    ${d.userId}: $${d.amount}
    <button class="btn-sm" onclick="approveDeposit(${i})">Approve</button>
    <button class="btn-sm" onclick="rejectDeposit(${i})">Reject</button>
  </div>`).join("");
  document.getElementById("pendingDeposits").innerHTML = html || "No pending deposits";

  let wd = withdrawals.filter(w => w.status === "pending");
  let whtml = wd.map((w,i)=>`<div>
    ${w.userId}
    <button class="btn-sm" onclick="approveWithdraw(${i})">Approve</button>
    <button class="btn-sm" onclick="rejectWithdraw(${i})">Reject</button>
  </div>`).join("");
  document.getElementById("withdrawRequests").innerHTML = whtml || "No withdrawal requests";

  let ulist = users.map(u=>`<div><b>${u.id}</b>: ${u.name}, Wallet: ${u.wallet}, Ref: ${u.ref}</div>`).join("");
  document.getElementById("userList").innerHTML = ulist;
}

function approveDeposit(i) {
  let item = deposits.filter(d=>d.status==="pending")[i];
  item.status = "approved";
  deposits = deposits.map(d => (d.userId === item.userId && d.amount === item.amount && d.status!=="approved") ? item : d);

  let user = users.find(u=>u.id===item.userId);
  if (user && user.ref) {
    let refUser = users.find(u=>u.id === user.ref);
    if (refUser) {
      let bonus = item.amount * 0.10;
      refUser.refIncome += bonus;
      users = users.map(u => u.id === refUser.id ? refUser : u);
    }
  }

  saveAll();
  loadAdmin();
}

function rejectDeposit(i) {
  let item = deposits.filter(d=>d.status==="pending")[i];
  deposits = deposits.filter(d => !(d.userId === item.userId && d.amount === item.amount && d.status === "pending"));
  saveAll();
  loadAdmin();
}

function approveWithdraw(i) {
  let item = withdrawals.filter(w=>w.status==="pending")[i];
  item.status = "approved";
  saveAll();
  loadAdmin();
}

function rejectWithdraw(i) {
  let item = withdrawals.filter(w=>w.status==="pending")[i];
  item.status = "rejected";
  saveAll();
  loadAdmin();
}

if (currentUser) showDashboard();
</script>
</body>
</html>
